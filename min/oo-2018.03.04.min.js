// OoLibrary Copyright (c) wanu@nyagoya
// Released under the MIT license http://opensource.org/licenses/mit-license.php

class OoApng{constructor(t){this.img=new Image,this.img.src=t,this.img.id=t,this.file=t,this.frame_scale=1,this.position=new Oo2DVector(0,0),this.size=new Oo2DVector(this.img.width,this.img.height),this.img.style.position="absolute",this.img.style.zIndex=0,this.img.style.opacity=1,this.img.style.userSelect="none",this.updateStyle()}setImageId(t){this.img.id=t}restart(){this.img.src=this.file}append(){document.body.appendChild(this.img)}remove(){document.body.removeChild(this.img)}setXY(t,e){this.position.x=t,this.position.y=e,this.updateStyle()}setXYWH(t,e,i,s){this.position.x=t,this.position.y=e,this.size.x=i,this.size.y=s,this.updateStyle()}setFrameScale(t){this.frame_scale=t,this.updateStyle()}updateStyle(){this.img.style.left=this.frame_scale*this.position.x+"px",this.img.style.top=this.frame_scale*this.position.y+"px",this.img.style.width=this.frame_scale*this.size.x+"px",this.img.style.height=this.frame_scale*this.size.y+"px"}}var oo;(oo=oo||{}).async=function(t){var e=new Image;e.src="",e.onerror=t},oo.serial=function(t,e){function i(){s.next().done&&e&&e()}var s=t(i);i()},oo.parallel=function(t,e){var i=0;for(var s=t(function(){1==i--&&e&&e()});!s.next().done;)i++;0===i&&e&&e()},oo.createAsyncGeneratorWithList=function(t,e){return function*(i){for(var s of e)yield t(i,s)}},oo.createAsyncGeneratorWithImageList=function(t,e,i,s){return function*(o){var a=void 0===s?"":"."+s,r=void 0===e?"":e+"/";for(var n of i)Array.isArray(n)?yield t[n[0]]=oo.asyncCreateImage(o,r+n[1]+a):yield t[n]=oo.asyncCreateImage(o,r+n+a)}},oo.asyncCreateImage=function(t,e){var i=new Image;return i.src=e,i.onload=t,i.onerror=t,i},oo.asyncAppendScript=function(t,e){var i=document.createElement("script");i.src=e,i.onload=t,i.onerror=t,document.body.appendChild(i)},oo.asyncFunction=function(t,e){e(),oo.async(t)},oo.createAsyncFunction=function(t){return function(e){t(),oo.async(e)}},oo.createSyncGeneratorForImageList=function(t,e,i){return function*(s){for(var o of e)yield t[o[0]]=oo.syncCreateImage(s,o[1],i)}},oo.createSyncGeneratorForImageList2=function(t,e,i,s){return function*(o){for(var a of i)yield t[a]=oo.syncCreateImage(o,a+"."+s,e)}},oo.syncCreateImage=function(t,e,i){var s=new Image;return i&&(e=i+"/"+e),s.src=e,s.onload=t,s.onerror=t,s},oo.syncAppendScript=function(t,e){var i=document.createElement("script");i.src=e,i.onload=t,document.body.appendChild(i)},oo.sync=function(t,e){setTimeout(t,0),e()},oo.syncFunc=function(t){return function(e){setTimeout(e,0),t()}},oo.syncGen=function(t){return function*(e){t(),yield setTimeout(e,0)}},(oo=oo||{}).env=oo.env||{},oo.env.debug_log=!1,oo.isValidObject=function(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)},oo.clone=function(t){return Object.assign({},t)},oo.deepClone=function(t){if("object"!=typeof t)return t;if(null===t)return null;if(Array.isArray(t)){var e=[];for(var i of t)e.push(oo.deepClone(i));return e}var s={},o=Object.keys(t);for(var a of o)s[a]=oo.deepClone(t[a]);return s},oo.setupQuery=function(){var t={},e=function(e,i,s){var o;if("#"===e.charAt(0)){var a=e.substr(1);return(o=document.getElementById(a))||(t[a]?t[a]:null)}return"@"===e.charAt(0)?document.createTextNode(e.substr(1)):(o=document.createElement(e),void 0!==i&&("string"==typeof i?(i&&(t[o.id=i]=o),oo.isValidObject(s)&&Object.assign(o.style,s)):(oo.isValidObject(i.property)&&Object.assign(o,i.property),oo.isValidObject(i.style)&&Object.assign(o.style,i.style),o.id&&(t[o.id]=o))),o)};return Node.prototype.$=function(t,i,s){return this.appendChild(e(t,i,s))},e},oo.main=function(t){document.addEventListener("DOMContentLoaded",function(){t()},!1)},(oo=oo||{}).fxsRotationType={kNormal:0,kDirection:1},oo.fxsDirectionType={kNormal:0,kSphere:1,kDist:2,kCenter:3},oo.fxsDistributionType={kNone:0,kUniform:1,kBall:2,kSphere:3};class FxsLerpParam{constructor(t,e,i){this.a=void 0===t?0:t,this.b=void 0===e?0:e,this.p=void 0===i?0:i}}class FxsEmitterFrame{constructor(){this.frame_num=0,this.num_ppf=0,this.life_time=0,this.life_time_dist=0,this.direction_type=oo.fxsDirectionType.kNormal,this.direction=new Oo2DVector(0,0),this.direction_dist=0,this.velocity0=0,this.velocity1=0,this.distribution_type=oo.fxsDistributionType.kNone,this.position=new Oo2DVector(0,0),this.position_dist=new Oo2DVector(0,0),this.scale0=1,this.scale1=1,this.rotation0=0,this.rotation1=0,this.rotation_v0=0,this.rotation_v1=0,this.frame_offset_dist=0}}class FxsParticleFrame{constructor(){this.frame_num=0,this.scale=new Oo2DVector(1,1),this.alpha=1}}class FxsTypeBase{constructor(){this.frame_data=[],this.frame_lerp_array=[]}createFrameLerpArray(){for(var t=this.frame_data.length,e=0,i=0,s=0,o=0;o<t;o++){for(;e<this.frame_data[o].frame_num;e++){var a=this.frame_data[i].frame_num,r=this.frame_data[s].frame_num,n=oo.smoothstep(a,r,e);this.frame_lerp_array[e]=new FxsLerpParam(i,s,n)}i=s,s=Math.min(s+1,t-1)}this.frame_lerp_array[e]=new FxsLerpParam(s,s,0)}getFrameLerpParam(t){if(t<0)return this.frame_lerp_array[0];var e=this.frame_lerp_array.length;return t>=e?this.frame_lerp_array[e-1]:this.frame_lerp_array[t]}getFrameData(t){var e=this.getFrameLerpParam(t);return this.frame_data[e.a]}}class FxsParticleType extends FxsTypeBase{constructor(){super(),this.id="",this.loop=!1,this.total_frames=0,this.size=new Oo2DVector(1,1),this.center=new Oo2DVector(0,0),this.texture_file="",this.world=!1}getFrameData(t){var e=this.getFrameLerpParam(t),i=this.frame_data[e.a],s=this.frame_data[e.b],o=new FxsParticleFrame;return o.frame_num=t,o.alpha=oo.lerp(i.alpha,s.alpha,e.p),o.scale.x=oo.lerp(i.scale.x,s.scale.x,e.p),o.scale.y=oo.lerp(i.scale.y,s.scale.y,e.p),o}}class FxsEmitterType extends FxsTypeBase{constructor(){super(),this.id="",this.loop=!1,this.total_frames=0,this.particle_name="",this.max_particles=0}}class FxsEmitterStatus{constructor(){this.show=!0,this.current_frame=-1,this.num_particles=0,this.emitter_type=null,this.particle_type=null,this.particle_status_array=[]}}class FxsParticleStatus{constructor(){this.current_frame=0,this.life_time=0,this.position=new Oo2DVector(0,0),this.velocity=new Oo2DVector(0,0),this.size=new Oo2DVector(1,1),this.scale=new Oo2DVector(1,1),this.rotation=0,this.rotation_v=0}}class OoFxs{constructor(){this.position=new Oo2DVector(0,0)}generateParticle(t,e,i){t.current_frame=-1,t.current_frame+=Math.floor(e.frame_offset_dist*Math.random()),t.life_time=e.life_time,t.position.set(e.position),e.distribution_type===oo.fxsDistributionType.kUniform&&(t.position.x+=e.position_dist.x*(2*Math.random()-1),t.position.y+=e.position_dist.y*(2*Math.random()-1)),i.world&&t.position.add(this.position);var s=oo.lerp(e.velocity0,e.velocity1,Math.random());e.direction_type===oo.fxsDirectionType.kNormal&&(t.velocity.x=e.direction.x*s,t.velocity.y=e.direction.y*s);var o,a,r,n,h;if(e.direction_type===oo.fxsDirectionType.kSphere){var c=(o=2*Math.random()-1,a=Math.sqrt(1-o*o),r=Math.random()*Math.PI*2,n=a*Math.cos(r),h=a*Math.sin(r),new Oo2DVector(n,h));t.velocity.x=c.x*s,t.velocity.y=c.y*s}var l=oo.lerp(e.scale0,e.scale1,Math.random());t.size.x=i.size.x*l,t.size.y=i.size.y*l,t.rotation=oo.lerp(e.rotation0,e.rotation1,Math.random()),t.rotation_v=oo.lerp(e.rotation_v0,e.rotation_v1,Math.random())}update(){var t=this.emitter_status,e=t.emitter_type;t.current_frame++,e.loop&&(t.current_frame%=e.total_frames);for(var i=e.getFrameData(t.current_frame),s=0,o=0;o<t.num_particles;o++)t.particle_status_array[o].life_time<=0||(o!==s&&(t.particle_status_array[s]=t.particle_status_array[o]),s++);t.num_particles=s;var a=t.num_particles;for(o=0;o<i.num_ppf&&!(t.num_particles>=e.max_particles);o++)t.particle_status_array[a+o]=new FxsParticleStatus,this.generateParticle(t.particle_status_array[a+o],i,t.particle_type),t.num_particles++;for(o=0;o<t.num_particles;o++){var r=t.particle_status_array[o];r.current_frame++;var n=t.particle_type.getFrameData(r.current_frame);r.life_time--,r.position.add(r.velocity),r.scale.set(n.scale),r.rotation+=r.rotation_v}}draw(t){for(var e=0;e<this.emitter_status.num_particles;e++){var i=this.emitter_status.particle_status_array[e],s=this.particle_type;t.save();var o=i.size.x*i.scale.x,a=i.size.y*i.scale.y,r=i.position.x,n=i.position.y;s.world||(r+=this.position.x,n+=this.position.y),t.translate(r,n),t.rotate(i.rotation*Math.PI/180),t.drawImage(this.image,-o*(.5+s.center.x),-a*(.5+s.center.y),o,a),t.restore()}}}class OoGameButton{constructor(t,e,i,s,o,a){this.name=t,this.enable=!0,this.position=new Oo2DVector(e,i),this.size=new Oo2DVector(s,o),this.image=new Image,this.image.src=a}isInside(t){var e=this.position.x-t.x,i=this.position.y-t.y;return!(Math.abs(e)>.5*this.size.x)&&!(Math.abs(i)>.5*this.size.y)}draw(t){t.drawImage(this.image,this.position.x-.5*this.size.x,this.position.y-.5*this.size.y,this.size.x,this.size.y)}}class OoGameFrame{constructor(){this.game_loop_type=2,this.fps=60,this.horizontal_scaling=!1,this.vertical_scaling=!1,this.bottom_origin=!1,this.offset=new Oo2DVector(0,0),this.screen_width=1080,this.screen_height=1920,this.canvas_width=this.screen_width,this.canvas_height=this.screen_height,this.scale=1,this.canvas,this.context,this.scene_array=[],this.click_on=!1,this.click_position=new Oo2DVector(0,0),this.input=new OoGameInput,this.touch_on=!1,this.touch_press=!1;try{this.audio_context=new AudioContext}catch(t){console.log("oo:new AudioContext() exception")}}getOffsetClickPosition(){return Oo2DVector.sub(this.click_position,this.offset)}addGameScene(t){this.scene_array.push(t)}startScene(t){this.setSceneStatus(t,oo.gameSceneStatus.kStart)}endScene(t){this.setSceneStatus(t,oo.gameSceneStatus.kEnd)}setSceneStatus(t,e){for(var i of this.scene_array)i.name===t&&(i.scene_status=e)}update(){var t=new OoGameInputStatus;for(var e of(t.touch_press=this.touch_press||this.touch_on,t.touch_position=this.touch_position,this.input.addStatus(t),this.touch_on=!1,this.scene_array))e.scene_status===oo.gameSceneStatus.kActive&&e.update(this);for(e of this.scene_array)e.scene_status===oo.gameSceneStatus.kEnd&&(e.release(),e.scene_status=oo.gameSceneStatus.kInactive);for(e of this.scene_array)e.scene_status===oo.gameSceneStatus.kStart&&(e.create(this),e.update(this),e.scene_status=oo.gameSceneStatus.kActive)}render(){for(var t of this.scene_array)t.scene_status===oo.gameSceneStatus.kActive&&t.render(this);this.click_on=!1}setHorizontalScaling(){this.horizontal_scaling=!0}setVerticalScaling(){this.vertical_scaling=!0}setBottomOrigin(){this.bottom_origin=!0}setCanvasScaleWH(t,e,i){this.scale=Math.min(e/this.screen_width,i/this.screen_height),this.horizontal_scaling&&(this.scale=e/this.screen_width),this.vertical_scaling&&(this.scale=i/this.screen_height);var s=this.screen_width,o=this.screen_height;this.horizontal_scaling&&(o=this.screen_width*i/e),this.vertical_scaling&&(s=this.screen_height*e/i),this.canvas_width=s,this.canvas_height=o,t.width=s,t.height=o,this.bottom_origin&&(this.offset.y=o-this.screen_height)}createDrawEnv(t){t?this.setCanvasScaleWH(t,t.clientWidth,t.clientHeight):(oo.env.debug_log&&console.log("createDrawEnv:create canvas"),t=document.createElement("canvas"),document.body.appendChild(t),this.setCanvasScaleWH(t,window.innerWidth,window.innerHeight),t.style.width=t.width*this.scale+"px",t.style.height=t.height*this.scale+"px",t.style.position="absolute",t.style.background="#666666",t.style.zIndex=1),this.canvas=t,this.context=t.getContext("2d")}clear(){this.context.clearRect(0,0,this.screen_width,this.screen_height)}drawImage(t,e,i,s,o){if(t){var a=void 0===s?t.width:s,r=void 0===o?t.height:o;this.context.drawImage(t,e,i,a,r)}}drawImageCenter(t,e,i,s,o){if(t){var a=void 0===s?t.width:s,r=void 0===o?t.height:o;this.context.drawImage(t,e-.5*a,i-.5*r,a,r)}}drawFrameImage(t,e,i,s,o){if(t)for(var a=(t.width-2)/2,r=(t.height-2)/2,n=[0,a,a+2],h=[0,r,r+2],c=[a,2,a],l=[r,2,r],u=[e,e+a,e+s-a],d=[i,i+r,i+o-r],f=[a,s-2*a,a],y=[r,o-2*r,r],p=0;p<3;p++)for(var m=0;m<3;m++)this.context.drawImage(t,n[m],h[p],c[m],l[p],u[m],d[p],f[m],y[p])}setupInput(){var t=this;function e(e){var i=e.target.getBoundingClientRect(),s=new Oo2DVector;return s.x=(e.clientX-i.left)/t.scale,s.y=(e.clientY-i.top)/t.scale,s}document.addEventListener("click",function(e){var i=e.target.getBoundingClientRect();t.click_on=!0,t.click_position.x=(e.clientX-i.left)/t.scale,t.click_position.y=(e.clientY-i.top)/t.scale},!1),document.addEventListener("touchend",function(e){var i=e.target.getBoundingClientRect();t.click_on=!0,t.click_position.x=(e.changedTouches[0].pageX-i.left)/t.scale,t.click_position.y=(e.changedTouches[0].pageY-i.top)/t.scale},!1),document.addEventListener("mousedown",function(i){t.touch_press=!0,t.touch_on=!0,t.touch_position=e(i)},!1),document.addEventListener("mousemove",function(i){t.touch_position=e(i)},!1),document.addEventListener("mouseup",function(i){t.touch_press=!1,t.touch_position=e(i)},!1)}setupGameLoop(){var t=this,e=this.fps;0===this.game_loop_type&&setInterval(function(){t.update(),t.render()},1e3/e),1===this.game_loop_type&&setTimeout(function i(){setTimeout(i,1e3/e),t.update(),t.render()},1e3/e),2===this.game_loop_type&&requestAnimationFrame(function e(){requestAnimationFrame(e),t.update(),t.render()})}}class OoGameInputStatus{constructor(){this.touch_press=!1,this.touch_position=new Oo2DVector(0,0)}}class OoGameInput{constructor(){this.status_array=[],this.status_array[0]=new OoGameInputStatus,this.status_array[1]=new OoGameInputStatus}addStatus(t){this.status_array.pop(),this.status_array.unshift(t)}getTouchPosition(){return this.status_array[0].touch_position}isTouch(){return!0===this.status_array[0].touch_press}isTouchStart(){return!0===this.status_array[0].touch_press&&!1===this.status_array[1].touch_press}isTouchEnd(){return!1===this.status_array[0].touch_press&&!0===this.status_array[1].touch_press}}class OoGameLayoutCell{constructor(){this.show=!0,this.name="",this.parent="",this.order=0,this.alpha=1,this.align=0,this.x=0,this.y=0,this.w=0,this.h=0,this.tool=!1,this.border=!1,this.text="",this.fontsize=0,this.color="#000000",this.bold=!1,this.wrap=!1,this.image="",this.img=null,this.rect=new OoRect}updateRect(t){this.rect||(this.rect=new OoRect,this.rect.setXYWH(0,0,t.screen_width,t.screen_height));var e=t.cell_map.get(this.parent);if(e){var i=e.getAlignedRect(t);i&&this.rect.setRect(i)}}getAlignedRect(t){this.rect||this.updateRect(t);var e=oo.createOoRectWithXYWH(this.x,this.y,this.w,this.h);return oo.getAlignedRect(this.rect,e,this.align)}getImageRect(){if(this.img){var t=oo.createOoRectWithXYWH(this.x,this.y,this.img.width,this.img.height);return oo.getAlignedRect(this.rect,t,this.align)}}draw(t,e,i){var s=void 0===e?0:e,o=void 0===i?0:i;if(this.alpha<1&&(t.globalAlpha=this.alpha),this.border){var a=oo.createOoRectWithXYWH(this.x,this.y,this.w,this.h),r=oo.getAlignedRect(this.rect,a,this.align);t.strokeStyle=this.color,t.beginPath(),t.strokeRect(r.x0+s,r.y0+o,r.getW(),r.getH())}if(this.img){var n=oo.createOoRectWithXYWH(this.x,this.y,this.img.width,this.img.height);r=oo.getAlignedRect(this.rect,n,this.align),t.drawImage(this.img,r.x0+s,r.y0+o)}if(this.text){var h="";this.bold&&(h+="bold "),h+=this.fontsize+"px ",h+=" ''",t.font=h,t.fillStyle=this.color,t.textAlign="left",t.textBaseline="top";var c=oo.clamp(this.align,1,9),l=oo.createOoRectWithXYWH(this.x,this.y,0,0);r=oo.getAlignedRect(this.rect,l,c);t.textAlign=["left","center","right"][(c+2)%3],t.textBaseline=["top","middle","bottom"][Math.floor((c-1)/3)],t.fillText(this.text,r.x0+s,r.y0+o)}t.globalAlpha=1}}class OoGameLayout{constructor(){this.layout_name="",this.image_base_path="",this.display_width=108,this.display_height=192,this.screen_width=1080,this.screen_height=1920,this.cells=[],this.cell_map=new Map,this.cell_order=[]}draw(t,e){var i=void 0===e?0:e.x,s=void 0===e?0:e.y;for(var o of(0===this.cell_order.length&&(this.cell_order=this.cells.slice()),this.cell_order))o.rect||o.updateRect(this),o.show&&o.draw(t,i,s)}updateCellMap(){for(var t of(this.cell_map.clear(),this.cells))t.name&&this.cell_map.set(t.name,t)}updateCoordinate(){for(var t of this.cells)t.rect=null;for(t of this.cells)t.updateRect(this)}updateOrder(){this.cell_order=this.cells.slice(),oo.sort(this.cell_order,function(t,e){return t.order>e.order?1:0})}loadJson(t){var e=JSON.parse(t);for(var i of(this.layout_name=e.layout_name,this.image_base_path=e.image_base_path,this.display_width=e.display_width,this.display_height=e.display_height,this.screen_width=e.screen_width,this.screen_height=e.screen_height,e.cells)){var s=new OoGameLayoutCell;Object.assign(s,i),this.cells.push(s)}this.updateCellMap(),this.updateCoordinate(),this.updateOrder()}syncLoadImage(t){var e=this;oo.parallel(function*(t){for(var i of e.cells)i.tool||i.image&&(i.img=oo.syncCreateImage(t,i.image,e.image_base_path),yield)},t)}syncSetupFromFile(t,e){var i=this;oo.serial(function*(t){var s=oo.syncLoadText(t,e);yield,i.loadJson(s.text),i.syncLoadImage(t),yield},t)}}(oo=(oo=(oo=oo||{})||{})||{}).gameSceneStatus={kInactive:0,kActive:1,kStart:2,kEnd:3};class OoGameScene{constructor(){this.name="",this.scene_status=oo.gameSceneStatus.kInactive,this.next_scene="",this.scene_end=!1,this.fade_times=60,this.fade_counter=0,this.fade_alpha=0}create(t){this.scene_end=!1}release(t){}update(t){}render(t){}changeSceneOnFadeOut(t){""!==this.next_scene&&(t.endScene(this.name),t.startScene(this.next_scene))}fadeIn(){this.fade_counter=-this.fade_times,this.setFadeAlpha()}fadeOut(){this.fade_counter=1,this.setFadeAlpha()}setFadeAlpha(){this.fade_alpha=Math.abs(this.fade_counter/this.fade_times),this.fade_alpha<0&&(this.fade_alpha=0),this.fade_alpha>1&&(this.fade_alpha=1)}updateFade(t){this.setFadeAlpha(),0!==this.fade_counter&&this.fade_counter++,this.fade_counter===this.fade_times+2&&this.changeSceneOnFadeOut(t)}renderFade(t){t.canvas.style.opacity=1-this.fade_alpha}}class OoGameScroll{constructor(){this.touch_pos=new Oo2DVector(0,0),this.pos_delta=[],this.pos_delta[0]=new Oo2DVector(0,0),this.pos_delta[1]=new Oo2DVector(0,0),this.velocity=new Oo2DVector(0,0),this.offset=new Oo2DVector(0,0),this.y_min=0,this.y_max=1e3,this.x_min=0,this.x_max=1e3,this.resistance=3,this.attenuation=.95,this.attenuation_out=.95,this.resilience=.9}update(t){t.isTouchStart()&&(this.touch_pos=t.getTouchPosition()),t.isTouch()&&(this.pos_delta[1]=this.pos_delta[0],this.pos_delta[0]=Oo2DVector.sub(t.getTouchPosition(),this.touch_pos),this.touch_pos=t.getTouchPosition(),this.velocity.x=.5*(this.pos_delta[0].x+this.pos_delta[1].x),this.velocity.y=.5*(this.pos_delta[0].y+this.pos_delta[1].y));var e=this.velocity.x,i=this.velocity.y;return this.offset.x>=this.x_min&&this.offset.x+e<=this.x_min&&(e-=this.x_min-this.offset.x),this.offset.x<=this.x_max&&this.offset.x+e>=this.x_max&&(e-=this.x_max-this.offset.x),this.offset.x<=this.x_min&&this.velocity.x<0&&(e/=this.resistance),this.offset.x>=this.x_max&&this.velocity.x>0&&(e/=this.resistance),this.offset.y>=this.y_min&&this.offset.y+i<=this.y_min&&(i-=this.y_min-this.offset.y),this.offset.y<=this.y_max&&this.offset.y+i>=this.y_max&&(i-=this.y_max-this.offset.y),this.offset.y<=this.y_min&&this.velocity.y<0&&(i/=this.resistance),this.offset.y>=this.y_max&&this.velocity.y>0&&(i/=this.resistance),this.offset.x+=e,this.offset.y+=i,t.isTouch()||(this.velocity.mulNum(this.attenuation),this.offset.x<=this.x_min&&this.velocity.x<0&&(this.velocity.x*=this.attenuation_out),this.offset.x>=this.x_max&&this.velocity.x>0&&(this.velocity.x*=this.attenuation_out),this.offset.y<=this.y_min&&this.velocity.y<0&&(this.velocity.y*=this.attenuation_out),this.offset.y>=this.y_max&&this.velocity.y>0&&(this.velocity.y*=this.attenuation_out),this.offset.x<this.x_min&&(this.offset.x=(this.offset.x-this.x_min)*this.resilience+this.x_min),this.offset.x>this.x_max&&(this.offset.x=(this.offset.x-this.x_max)*this.resilience+this.x_max),this.offset.y<this.y_min&&(this.offset.y=(this.offset.y-this.y_min)*this.resilience+this.y_min),this.offset.y>this.y_max&&(this.offset.y=(this.offset.y-this.y_max)*this.resilience+this.y_max)),this.getOffset()}getOffset(){return this.offset}}class OoRandom{constructor(t){this.init(t);var e,i,s,o,a=this;this.getNormalDistribution=(o=function*(){for(;;){do{e=a.get2(),i=a.get2(),s=e*e+i*i}while(s>1||0===s);s=Math.sqrt(-2*Math.log(s)/s),yield e*s,yield i*s}}(),function(){return o.next().value})}init(t){this.x=123456789,this.y=362436069,this.z=521288629,this.w=88675123,void 0!==t&&(this.seed=t),void 0!==this.seed&&(this.w=this.seed)}getUint32(){var t=this.x^this.x<<11;return this.x=this.y,this.y=this.z,this.z=this.w,this.w=this.w^this.w>>>19^t^t>>>8,this.w=this.w>>>0,this.w}get(){return this.getUint32()/4294967296}get1(){return this.getUint32()/4294967295}get2(){return this.getUint32()/2147483648-1}getND(){return this.getNormalDistribution()}getRange(t,e){return t+this.get1()*(e-t)}getIntRange(t,e){return t+this.roll0(e-t+1)}roll0(t){return t=t||6,this.getUint32()%t}roll(t){return this.roll0(t)+1}}class OoRect{constructor(){this.x0=0,this.y0=0,this.x1=0,this.y1=0}setXYWH(t,e,i,s){this.x0=t,this.y0=e,this.x1=t+i,this.y1=e+s}setRect(t){this.x0=t.x0,this.y0=t.y0,this.x1=t.x1,this.y1=t.y1}getW(){return this.x1-this.x0}getH(){return this.y1-this.y0}isContains(t){return!(t.x<this.x0||t.x>=this.x1)&&!(t.y<this.y0||t.y>=this.y1)}}(oo=oo||{}).createOoRectWithXYWH=function(t,e,i,s){var o=new OoRect;return o.setXYWH(t,e,i,s),o},oo.getAlignedRect=function(t,e,i){var s=t.x0,o=t.y0,a=e.getW(),r=e.getH();1!==i&&4!==i&&7!==i||(s=t.x0),2!==i&&5!==i&&8!==i||(s=(t.x0+t.x1-a)/2),3!==i&&6!==i&&9!==i||(s=t.x1-a),1!==i&&2!==i&&3!==i||(o=t.y0),4!==i&&5!==i&&6!==i||(o=(t.y0+t.y1-r)/2),7!==i&&8!==i&&9!==i||(o=t.y1-r);new OoRect;return oo.createOoRectWithXYWH(s+e.x0,o+e.y0,a,r)},(oo=oo||{}).sort=function(t,e){var i=function(s,o){if(!(s>=o))if(o-s!=1){var a,r,n,h,c=Math.floor((s+o)/2);i(s,c),i(c+1,o);for(var l=[],u=0,d=s;d<=c;d++)l[u++]=t[d];d=c+1;for(var f=0,y=s;d<=o&&f<u;)t[y++]=e(l[f],t[d])<=0?l[f++]:t[d++];for(;f<u;)t[y++]=l[f++]}else e(t[s],t[o])>0&&(n=o,h=(a=t)[r=s],a[r]=a[n],a[n]=h)};i(0,t.length-1)};class OoSound{constructor(t,e){if(t){this.context=t,this.name=e,this.buffer;var i=this,s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onreadystatechange=function(){4===s.readyState&&(0!==s.status&&200!==s.status||i.context.decodeAudioData(s.response,function(t){i.buffer=t}))},s.send("")}}play(){if(this.context){var t=this.context.createBufferSource();t.buffer=this.buffer,t.connect(this.context.destination),t.start()}}}(oo=oo||{}).syncLoadText=function(t,e){var i={},s=new XMLHttpRequest;return s.open("GET",e,!0),s.onreadystatechange=function(){4===s.readyState&&(0!==s.status&&200!==s.status||(i.text=s.response,t()))},s.send(""),i},oo.backSlashToSlash=function(t){for(var e="",i=0;i<t.length;i++){var s=t.charAt(i);e+="\\"===s?"/":s}return e},oo.getFolder=function(t){var e=(t=oo.backSlashToSlash(t)).lastIndexOf("/");return t.substr(0,e+1)},oo.getFilename=function(t){var e=(t=oo.backSlashToSlash(t)).lastIndexOf("/");return t.substr(e+1)},oo.getNonExtension=function(t){var e=(t=oo.backSlashToSlash(t)).lastIndexOf(".");return e<0?t:t.substr(0,e)},oo.saveText=function(t,e){var i=new Blob([e],{type:"text/plain"}),s=document.createElement("a");s.href=URL.createObjectURL(i),s.download=t+".txt",s.click()},oo.loadText=function(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onreadystatechange=function(){4===i.readyState&&(0!==i.status&&200!==i.status||e(i.response))},i.send("")},oo.getArrayDiff=function(t,e){var i=[];for(var s of t)-1===e.indexOf(s)&&i.push(s);for(s of e)-1===t.indexOf(s)&&i.push(s);return i},oo.setupLogEnv=function(){var t=null;oo.log=function(e){console.log(e),null===t&&document.body&&(t=document.createElement("div"),document.body.appendChild(t)),t&&(t.innerHTML+=e+"<br>")}},oo.log=function(t){console.log(t)},oo.appendScript=function(t,e){var i=t.slice();!function t(){var s=document.createElement("script");s.src=i.shift(),s.onload=i.length?t:e,document.body.appendChild(s)}()},oo.getDataset=function(t,e){var i=document.getElementById(t);if(i)return i.dataset[e]},oo.drawRoundRect=function(t,e,i,s,o,a,r,n){var h=void 0===a?5:a;void 0===n&&(n=!0),t.beginPath(),t.moveTo(e+h,i),t.lineTo(e+s-h,i),t.quadraticCurveTo(e+s,i,e+s,i+h),t.lineTo(e+s,i+o-h),t.quadraticCurveTo(e+s,i+o,e+s-h,i+o),t.lineTo(e+h,i+o),t.quadraticCurveTo(e,i+o,e,i+o-h),t.lineTo(e,i+h),t.quadraticCurveTo(e,i,e+h,i),t.closePath(),r&&t.fill(),n&&t.stroke()},oo.setTextAttributes=function(t,e,i,s,o){t.font=`${e}px ''`,t.fillStyle=i,t.textAlign=s,t.textBaseline=o},oo.strToInt=function(t){var e=Number.parseInt(t);return Number.isInteger(e)?e:0},oo.createImageFromFile=function(t){var e=new Image;return e.src=t,e},oo.clamp=function(t,e,i){return t<e?e:t>i?i:t},oo.lerp=function(t,e,i){return(1-i)*t+i*e},oo.saturate=function(t){return t<0?0:t>1?1:t},oo.smoothstep=function(t,e,i){return t===e?0:oo.saturate((i-t)/(e-t))},oo.arraySwap=function(t,e,i){var s=t[e];t[e]=t[i],t[i]=s},oo.csvToArray2=function(t){for(var e=t.length,i=!1,s="",o=[],a=[],r=0;r<e;r++){var n=t.charAt(r);if('"'!==n){if(!i){if(","===n){a.push(s),s="";continue}if("\n"===n){(s.length||a.length)&&(a.push(s),s=""),a.length&&(o.push(a),a=[]);continue}}s+=n}else i?r+1<e&&'"'===t.charAt(r+1)?(s+='"',r+=1):i=!1:i=!0}return s.length&&a.push(s),a.length&&o.push(a),o},oo.csvToObjectArray=function(t){for(var e=[],i=oo.csvToArray2(t),s=1;s<i.length;s++){for(var o={},a=0;a<i[s].length;a++)o[i[0][a]]=i[s][a];e.push(o)}return e};class Oo2DVector{constructor(t,e){this.x=t,this.y=e}clone(){return new Oo2DVector(this.x,this.y)}set(t,e){return t instanceof Oo2DVector?(this.x=t.x,this.y=t.y):void 0===e?(this.x=t,this.y=t):(this.x=t,this.y=e),this}add(t){return t instanceof Oo2DVector?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=t),this}sub(t){return t instanceof Oo2DVector?(this.x-=t.x,this.y-=t.y):(this.x-=t,this.y-=t),this}mul(t){return t instanceof Oo2DVector?(this.x*=t.x,this.y*=t.y):(this.x*=t,this.y*=t),this}div(t){return t instanceof Oo2DVector?(0!==t.x&&(this.x/=t.x),0!==t.y&&(this.y/=t.y)):0!==t&&(this.x/=t,this.y/=t),this}clamp(t,e){return this.x<t&&(this.x=t),this.y<t&&(this.y=t),this.x>e&&(this.x=e),this.y>e&&(this.y=e),this}negative(){return this.x=-this.x,this.y=-this.y,this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}normalize(){var t=this.getMagnitude();return t>0&&(t=1/t),this.x*=t,this.y*=t,this}getNegative(){return this.clone().negative()}getRound(){return this.clone().round()}getNormal(){return this.clone().normalize()}getSquareMagnitude(){return this.x*this.x+this.y*this.y}getMagnitude(){return Math.sqrt(this.getSquareMagnitude())}getAtan2(){return Math.atan2(this.y,this.x)}getDegree(){return 180*Math.atan2(this.y,this.x)/Math.PI}static add(t,e){return new Oo2DVector(t.x+e.x,t.y+e.y)}static sub(t,e){return new Oo2DVector(t.x-e.x,t.y-e.y)}static mul(t,e){return new Oo2DVector(t.x*e.x,t.y*e.y)}static div(t,e){return new Oo2DVector(t.x/e.x,t.y/e.y)}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static distance(t,e){return Oo2DVector.sub(t,e).getMagnitude()}static lerp(t,e,i){return new Oo2DVector((1-i)*t.x+i*e.x,(1-i)*t.y+i*e.y)}}