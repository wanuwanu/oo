// OoLibrary Copyright (c) wanu@nyagoya
// Released under the MIT license http://opensource.org/licenses/mit-license.php

class OoDrawObject{constructor(){this.context=null,this.show=!0,this.position=new Oo3DVector(0),this.rotation=new Oo3DVector(0),this.scale=new Oo3DVector(1),this.alpha=1,this.blend_mode=oo.blendMode.kNormal}}class OoSprite extends OoDrawObject{constructor(t){super(),this.size=new Oo2DVector(1),this.image=null,t&&t instanceof Image&&(this.image=t,this.size.set(t.width,t.height))}draw(t){if(this.show){var e=t||this.context||oo.env.context;oo.localAlpha(e,this.alpha,()=>{var t=this.size.x*this.scale.x,i=this.size.y*this.scale.y;0===this.rotation.z?e.drawImage(this.image,this.position.x-.5*t,this.position.y-.5*i,t,i):(e.save(),e.setTransform(1,0,0,1,0,0),e.translate(this.position.x,this.position.y),e.rotate(this.rotation.z),e.drawImage(this.image,.5*-t,.5*-i,t,i),e.restore())})}}static create(t){var e=new OoSprite;return t instanceof Image&&(e.image=t,e.size.set(t.width,t.height)),e}}class OoRenderSprite extends OoSprite{constructor(t){super(),t&&t instanceof Image&&(this.size.set(t.width,t.height),this.canvas=document.createElement("canvas"),this.canvas.width=t.width,this.canvas.height=t.height,this.canvas_context=this.canvas.getContext("2d"),this.canvas_context.drawImage(t,0,0),this.image_data=this.canvas_context.getImageData(0,0,t.width,t.height),this.pixel=this.image_data.data,this.image=this.canvas)}create(t,e){this.size.set(t,e),this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this.canvas_context=this.canvas.getContext("2d"),this.image_data=this.canvas_context.createImageData(t,e),this.pixel=this.image_data.data,this.image=this.canvas}getCanvasImageData(){return this.canvas_context.getImageData(0,0,this.canvas.width,this.canvas.height)}getPixel(t,e){if(this.pixel&&!(t<0||t>=this.size.x||e<0||e>=this.size.y)){var i=4*(e*this.size.x+t);return[this.pixel[i+0],this.pixel[i+1],this.pixel[i+2],this.pixel[i+3]]}}setPixel(t,e,i){if(this.pixel&&!(t<0||t>=this.size.x||e<0||e>=this.size.y)){var s=4*(e*this.size.x+t);this.pixel[s+0]=i[0],this.pixel[s+1]=i[1],this.pixel[s+2]=i[2],this.pixel[s+3]=i[3]}}updateCanvas(){this.canvas_context.putImageData(this.image_data,0,0)}}class OoTextBox extends OoDrawObject{constructor(t,e,i,s,o,a,r,n,h){super(),this.size=new Oo2DVector(r||0,n||0),this.position=Oo2DVector.create(o||0,a||0).add(this.size.clone().mul(.5)),this.color=s||"#000000",this.text=t||"",this.font_size=e||0,this.linefeed_space=i||0,this.wordwrap_space=i||0,this.align=h||0,this.content_height=0,this.row=[],this.context=null,this.line_head_japanese_hyphenation=!1,this.line_head_japanese_hyphenation_characters="、。"}setRect(t){this.position=new Oo2DVector(t.x+.5*t.w,t.y+.5*t.h),this.size=new Oo2DVector(t.w,t.h)}_setTextAttributes(t){oo.setTextAttributes(t,this.font_size,this.color,"left","top")}createRow(t){var e=t||this.context||oo.env.context;this._setTextAttributes(e);var i={text:"",width:0,line_space:0};this.row=[oo.clone(i)],[...this.text].forEach(t=>{var s=this.row.length-1;if("\n"===t)this.row[s].line_space=this.linefeed_space,this.row.push(oo.clone(i));else{var o=e.measureText(this.row[s].text+t).width,a=!1;this.line_head_japanese_hyphenation&&this.line_head_japanese_hyphenation_characters.indexOf(t)>=0&&(a=!0),o>this.size.x&&!a?(this.row[s].line_space=this.wordwrap_space,this.row.push({text:t,width:e.measureText(t).width,line_space:0})):(this.row[s].text+=t,this.row[s].width=o)}}),this.content_height=0,this.row.forEach(t=>{this.content_height+=this.font_size,this.content_height+=t.line_space})}flush(){this.row=[]}getContentHeight(){return this.content_height}draw(t){if(this.show){var e=t||this.context||oo.env.context;oo.localAlpha(e,this.alpha,()=>{var t=this.size.x*this.scale.x,i=this.size.y*this.scale.y;0===this.row.length&&this.createRow(e),this._setTextAttributes(e);var s=oo.alignY(this.align,this.size.y-this.content_height);this.row.forEach(o=>{var a=oo.alignX(this.align,this.size.x-o.width);e.fillText(o.text,this.position.x+a-.5*t,this.position.y+s-.5*i),s+=this.font_size+o.line_space})})}}}(oo=(oo=oo||{})||{}).aesType={kAes128:0,kAes192:1,kAes256:2},oo.aes=oo.aes||{},oo.aes.kPolynomial=283,oo.aes.kAffineConstant0=31,oo.aes.kAffineConstant1=99,oo.aes.initialized=!1,oo.aes.sub_bytes_table=new Array(256),oo.aes.inv_sub_bytes_table=new Array(256),oo.aes.mix_column_3112_table=new Array(256),oo.aes.mix_column_bd9e_table=new Array(256),oo.aes.sub_byte_mix_column_3112_table=new Array(256),oo.aes.inv_sub_byte_mix_column_bd9e_table=new Array(256);class OoAes{constructor(){oo.aes.initialized||(OoAes._makeSubBytesTable(),OoAes._makeMixColumnTable(),oo.aes.initialized=!0),this._type="aes128",this._key_length=4,this._num_rounds=10,this._encrypt_round_key=new Array(60),this._decrypt_round_key=new Array(60)}static _leftRotate32(t,e){return t<<e|t>>>32-e}static _get32x4(t,e){for(var i=0;i<4;i++)t[i]=e[4*i]|e[4*i+1]<<8|e[4*i+2]<<16|e[4*i+3]<<24}static _put32x4(t,e){for(var i=0;i<4;i++)t[4*i]=255&e[i],t[4*i+1]=e[i]>>>8&255,t[4*i+2]=e[i]>>>16&255,t[4*i+3]=e[i]>>>24}static _mulPolynomial(t,e){for(var i=0,s=0;s<8;s++)i^=e>>>s&1?t<<s:0;for(s=14;s>=8;s--)i>>>s&1&&(i^=oo.aes.kPolynomial<<s-8);return i}static _getMultiplicativeInverse(t){for(var e=1,i=0;i<7;i++)t=OoAes._mulPolynomial(t,t),e=OoAes._mulPolynomial(e,t);return e}static _makeSubBytesTable(){for(var t=0;t<256;t++){for(var e=OoAes._getMultiplicativeInverse(t),i=0,s=oo.aes.kAffineConstant0,o=0;o<8;o++)e>>>o&1&&(i^=s<<o|s>>>8-o);i=255&i^oo.aes.kAffineConstant1,oo.aes.sub_bytes_table[t]=i,oo.aes.inv_sub_bytes_table[i]=t}}static _makeMixColumnTable(){for(var t=0;t<256;t++)oo.aes.mix_column_3112_table[t]=OoAes._mulPolynomial(3,t)<<24|t<<16|t<<8|OoAes._mulPolynomial(2,t),oo.aes.mix_column_bd9e_table[t]=OoAes._mulPolynomial(11,t)<<24|OoAes._mulPolynomial(13,t)<<16|OoAes._mulPolynomial(9,t)<<8|OoAes._mulPolynomial(14,t);for(t=0;t<256;t++){var e=oo.aes.sub_bytes_table[t];oo.aes.sub_byte_mix_column_3112_table[t]=oo.aes.mix_column_3112_table[e],oo.aes.inv_sub_byte_mix_column_bd9e_table[e]=oo.aes.mix_column_bd9e_table[t]}}static _subBytes(t){for(var e=t,i=0;i<16;i++)e[i]=oo.aes.sub_bytes_table[e[i]]}static _invSubBytes(t){for(var e=t,i=0;i<16;i++)e[i]=oo.aes.inv_sub_bytes_table[e[i]]}static _shiftRows(t,e){var i=[0,0,0,0];i[0]=255&t[0]^65280&t[1]^16711680&t[2]^4278190080&t[3],i[1]=255&t[1]^65280&t[2]^16711680&t[3]^4278190080&t[0],i[2]=255&t[2]^65280&t[3]^16711680&t[0]^4278190080&t[1],i[3]=255&t[3]^65280&t[0]^16711680&t[1]^4278190080&t[2];for(var s=0;s<4;s++)t[s]=i[s]}static _invShiftRows(t,e){var i=[0,0,0,0];i[0]=255&t[0]^65280&t[3]^16711680&t[2]^4278190080&t[1],i[1]=255&t[1]^65280&t[0]^16711680&t[3]^4278190080&t[2],i[2]=255&t[2]^65280&t[1]^16711680&t[0]^4278190080&t[3],i[3]=255&t[3]^65280&t[2]^16711680&t[1]^4278190080&t[0];for(var s=0;s<4;s++)t[s]=i[s]}static _mixColumns(t,e){for(var i=0;i<4;i++){var s=oo.aes.mix_column_3112_table[255&t[i]];s^=OoAes._leftRotate32(oo.aes.mix_column_3112_table[t[i]>>>8&255],8),s^=OoAes._leftRotate32(oo.aes.mix_column_3112_table[t[i]>>>16&255],16),s^=OoAes._leftRotate32(oo.aes.mix_column_3112_table[t[i]>>>24],24),t[i]=s}}static _invMixColumns(t,e){for(var i=e;i<e+4;i++){var s=oo.aes.mix_column_bd9e_table[255&t[i]];s^=OoAes._leftRotate32(oo.aes.mix_column_bd9e_table[t[i]>>>8&255],8),s^=OoAes._leftRotate32(oo.aes.mix_column_bd9e_table[t[i]>>>16&255],16),s^=OoAes._leftRotate32(oo.aes.mix_column_bd9e_table[t[i]>>>24],24),t[i]=s}}_addRoundKey(t,e){for(var i=0;i<4;i++)t[i]^=this._encrypt_round_key[4*e+i]}_keyExpansion(t){for(var e=0;e<this._key_length;e++)this._encrypt_round_key[e]=t[4*e]|t[4*e+1]<<8|t[4*e+2]<<16|t[4*e+3]<<24;var i=1;for(e=this._key_length;e<4*(this._num_rounds+1);e++){var s=this._encrypt_round_key[e-1];e%this._key_length==0?(s=oo.aes.sub_bytes_table[s>>>8&255]|oo.aes.sub_bytes_table[s>>>16&255]<<8|oo.aes.sub_bytes_table[s>>>24]<<16|oo.aes.sub_bytes_table[255&s]<<24,s^=i,i=OoAes._mulPolynomial(i,2)):this._key_length>6&&e%this._key_length==4&&(s=oo.aes.sub_bytes_table[255&s]|oo.aes.sub_bytes_table[s>>>8&255]<<8|oo.aes.sub_bytes_table[s>>>16&255]<<16|oo.aes.sub_bytes_table[s>>>24]<<24),this._encrypt_round_key[e]=this._encrypt_round_key[e-this._key_length]^s}for(var o=0;o<this._num_rounds+1;o++)for(e=0;e<4;e++){var a=this._num_rounds-o;this._decrypt_round_key[4*a+e]=this._encrypt_round_key[4*o+e]}for(e=1;e<this._num_rounds;e++)OoAes._invMixColumns(this._decrypt_round_key,4*e)}setKey(t,e){this._type=t,t===oo.aesType.kAes128&&(this._key_length=4,this._num_rounds=10),t===oo.aesType.kAes192&&(this._key_length=6,this._num_rounds=12),t===oo.aesType.kAes256&&(this._key_length=8,this._num_rounds=14),this._keyExpansion(e)}encrypt(t,e){var i=[0,0,0,0],s=[0,0,0,0],o=oo.aes.sub_byte_mix_column_3112_table,a=this._encrypt_round_key,r=0;OoAes._get32x4(i,e);for(var n=0;n<4;n++)i[n]^=a[r++];for(var h=1;h<this._num_rounds;h++)s[0]=o[255&i[0]]^OoAes._leftRotate32(o[i[1]>>>8&255],8)^OoAes._leftRotate32(o[i[2]>>>16&255],16)^OoAes._leftRotate32(o[i[3]>>>24],24)^a[r++],s[1]=o[255&i[1]]^OoAes._leftRotate32(o[i[2]>>>8&255],8)^OoAes._leftRotate32(o[i[3]>>>16&255],16)^OoAes._leftRotate32(o[i[0]>>>24],24)^a[r++],s[2]=o[255&i[2]]^OoAes._leftRotate32(o[i[3]>>>8&255],8)^OoAes._leftRotate32(o[i[0]>>>16&255],16)^OoAes._leftRotate32(o[i[1]>>>24],24)^a[r++],s[3]=o[255&i[3]]^OoAes._leftRotate32(o[i[0]>>>8&255],8)^OoAes._leftRotate32(o[i[1]>>>16&255],16)^OoAes._leftRotate32(o[i[2]>>>24],24)^a[r++],[i,s]=[s,i];var c=oo.aes.sub_bytes_table;s[0]=c[255&i[0]]^c[i[1]>>>8&255]<<8^c[i[2]>>>16&255]<<16^c[i[3]>>>24]<<24^a[r++],s[1]=c[255&i[1]]^c[i[2]>>>8&255]<<8^c[i[3]>>>16&255]<<16^c[i[0]>>>24]<<24^a[r++],s[2]=c[255&i[2]]^c[i[3]>>>8&255]<<8^c[i[0]>>>16&255]<<16^c[i[1]>>>24]<<24^a[r++],s[3]=c[255&i[3]]^c[i[0]>>>8&255]<<8^c[i[1]>>>16&255]<<16^c[i[2]>>>24]<<24^a[r++],OoAes._put32x4(t,s)}decrypt(t,e){var i=[0,0,0,0],s=[0,0,0,0],o=oo.aes.inv_sub_byte_mix_column_bd9e_table,a=this._decrypt_round_key,r=0;OoAes._get32x4(i,e);for(var n=0;n<4;n++)i[n]^=a[r++];for(var h=this._num_rounds-1;h>=1;h--)s[0]=o[255&i[0]]^OoAes._leftRotate32(o[i[3]>>>8&255],8)^OoAes._leftRotate32(o[i[2]>>>16&255],16)^OoAes._leftRotate32(o[i[1]>>>24],24)^a[r++],s[1]=o[255&i[1]]^OoAes._leftRotate32(o[i[0]>>>8&255],8)^OoAes._leftRotate32(o[i[3]>>>16&255],16)^OoAes._leftRotate32(o[i[2]>>>24],24)^a[r++],s[2]=o[255&i[2]]^OoAes._leftRotate32(o[i[1]>>>8&255],8)^OoAes._leftRotate32(o[i[0]>>>16&255],16)^OoAes._leftRotate32(o[i[3]>>>24],24)^a[r++],s[3]=o[255&i[3]]^OoAes._leftRotate32(o[i[2]>>>8&255],8)^OoAes._leftRotate32(o[i[1]>>>16&255],16)^OoAes._leftRotate32(o[i[0]>>>24],24)^a[r++],[i,s]=[s,i];var c=oo.aes.inv_sub_bytes_table;s[0]=c[255&i[0]]^c[i[3]>>>8&255]<<8^c[i[2]>>>16&255]<<16^c[i[1]>>>24]<<24^a[r++],s[1]=c[255&i[1]]^c[i[0]>>>8&255]<<8^c[i[3]>>>16&255]<<16^c[i[2]>>>24]<<24^a[r++],s[2]=c[255&i[2]]^c[i[1]>>>8&255]<<8^c[i[0]>>>16&255]<<16^c[i[3]>>>24]<<24^a[r++],s[3]=c[255&i[3]]^c[i[2]>>>8&255]<<8^c[i[1]>>>16&255]<<16^c[i[0]>>>24]<<24^a[r++],OoAes._put32x4(t,s)}encrypt_simple(t,e){var i=[0,0,0,0];OoAes._get32x4(i,e),this._addRoundKey(i,0);for(var s=1;s<this._num_rounds;s++)OoAes._subBytes(i),OoAes._shiftRows(i),OoAes._mixColumns(i),this._addRoundKey(i,s);OoAes._subBytes(i),OoAes._shiftRows(i),this._addRoundKey(i,this._num_rounds),OoAes._put32x4(t,i)}decrypt_simple(t,e){var i=[0,0,0,0];OoAes._get32x4(i,e),this._addRoundKey(i,this._num_rounds);for(var s=this._num_rounds-1;s>=1;s--)OoAes._invShiftRows(i),OoAes._invSubBytes(i),this._addRoundKey(i,s),OoAes._invMixColumns(i);OoAes._invShiftRows(i),OoAes._invSubBytes(i),this._addRoundKey(i,0),OoAes._put32x4(t,i)}encode(t){for(var e=[],i=(t.length+15)/16,s=new Array(16),o=0;o<i;o++){var a=t.slice(16*o,16*(o+1));this.encrypt(s,a);for(var r=0;r<16;r++)e[16*o+r]=s[r]}return e}decode(t){for(var e=[],i=t.length/16,s=new Array(16),o=0;o<i;o++){var a=t.slice(16*o,16*(o+1));this.decrypt(s,a);for(var r=0;r<16;r++)e[16*o+r]=s[r]}return e}}(oo=oo||{}).apng=oo.apng||{},oo.apng.png_signature=new Uint8Array([137,80,78,71,13,10,26,10]),oo.asyncCreateApng=function(t,e){var i=new OoApng,s=new XMLHttpRequest;return s.open("GET",t,!0),s.responseType="arraybuffer",s.onload=(()=>{i.create(s.response),e&&e()}),s.onerror=(()=>{e&&e()}),s.onabort=s.onerror,s.ontimeout=s.onerror,s.send(),i};class OoApng extends OoRenderSprite{constructor(){super(),this.image=null,this.is_apng=!1,this.time0=0,this.current_frame=0,this.frame_time0=0,this.play_counter=0,this.frames=[]}_scanChunks(t,e,i){for(;;){var s=this.readUint32(t,e),o=this.readString(t,e+4,4);if(i(o,e,s),(e+=8+s+4)>=t.size)break;if("IEND"===o)break}}create(t){for(var e=new Uint8Array(t),i=0;i<oo.apng.png_signature.length;i++)if(e[i]!==oo.apng.png_signature[i])return!1;this._scanChunks(e,8,(t,e,i)=>{"acTL"===t&&(this.is_apng=!0)}),this.is_apng?this._createApngImage(e):this._createPngImage(e)}_createPngImage(t){var e=new Blob([t],{type:"image/png"});this.image=new Image,this.image.src=URL.createObjectURL(e),this.image.onload=function(){},this.image.onerror=function(){oo.log("oo_apng : create error")},this._scanChunks(t,8,(e,i,s)=>{"IHDR"===e&&(this.width=this.readUint32(t,i+8),this.height=this.readUint32(t,i+8+4))}),this.size.set(this.width,this.height)}_createApngImage(t){var e=[],i={};i.IHDR=((e,i)=>{this.width=this.readUint32(t,e+8),this.height=this.readUint32(t,e+8+4),this.header={pos:e+8,length:i}}),i.acTL=(e=>{this.num_frames=this.readUint32(t,e+8),this.num_plays=this.readUint32(t,e+8+4)}),i.fcTL=(e=>{var i={};i.sequence_number=this.readUint32(t,e+8),i.width=this.readUint32(t,e+8+4),i.height=this.readUint32(t,e+8+8),i.x_offset=this.readUint32(t,e+8+12),i.y_offset=this.readUint32(t,e+8+16),i.delay_num=this.readUint16(t,e+8+20),i.delay_den=this.readUint16(t,e+8+22),i.dispose_op=this.readUint8(t,e+8+24),i.blend_op=this.readUint8(t,e+8+25),i.data=[],this.frames.push(i)}),i.fdAT=((t,e)=>{var i=this.frames.length;i&&this.frames[i-1].data.push({pos:t+8+4,length:e-4})}),i.IDAT=((t,e)=>{var i=this.frames.length;i&&this.frames[i-1].data.push({pos:t+8,length:e})}),this._scanChunks(t,8,(t,s,o)=>{"IEND"!==t&&(i[t]?i[t](s,o):e.push({pos:s,length:12+o}))});for(var s=0;s<this.frames.length;s++){var o=this.frames[s],a=[];a.push(oo.apng.png_signature);var r=this.makeU8(t,this.header);this.writeUint32(r,0,o.width),this.writeUint32(r,4,o.height),a.push(this.makeChunk("IHDR",r,0,r.length));for(var n=0;n<e.length;n++)a.push(this.makeU8(t,e[n]));for(n=0;n<o.data.length;n++)a.push(this.makeChunk("IDAT",t,o.data[n].pos,o.data[n].length));a.push(this.makeChunk("IEND",null,0,0));var h=new Blob(a,{type:"image/png"});o.img=new Image,o.img.src=URL.createObjectURL(h),o.img.onload=function(){},o.img.onerror=function(){oo.log("oo_apng : create error")}}super.create(this.width,this.height)}makeU8(t,e){for(var i=new Uint8Array(e.length),s=0;s<e.length;s++)i[s]=t[e.pos+s];return i}makeChunk(t,e,i,s){var o=t.length+s,a=new Uint8Array(o+8);this.writeUint32(a,0,s),this.writeString(a,4,t);for(var r=t.length+4,n=0;n<s;n++)a[r+n]=e[i+n];return this.writeUint32(a,o+4,OoCrc.get(a,4,o)),a}writeUint32(t,e,i){t[e+0]=i>>>24&255,t[e+1]=i>>>16&255,t[e+2]=i>>>8&255,t[e+3]=255&i}writeString(t,e,i){for(var s=0;s<i.length;s++)t[e+s]=i.charCodeAt(s)}readUint8(t,e){return t[e]}readUint16(t,e){return t[e]<<8|t[e+1]}readUint32(t,e){return this.readUint16(t,e)<<16|this.readUint16(t,e+2)}readString(t,e,i){for(var s="",o=0;o<i;o++)s+=String.fromCharCode(t[e+o]);return s}start(){this.play_counter=0,this.setStartFrame()}setStartFrame(){if(this.is_apng){this.time0=Date.now(),this.current_frame=0,this.frame_time0=0,this.canvas_context.clearRect(0,0,this.canvas.width,this.canvas.height);var t=this.frames[0];2===t.dispose_op&&this.pushCanvas(),this.canvas_context.drawImage(t.img,t.x_offset,t.y_offset)}}pushCanvas(){this.image_data=this.canvas_context.getImageData(0,0,this.canvas.width,this.canvas.height)}popCanvas(){this.canvas_context.putImageData(this.image_data,0,0)}update(){if(this.is_apng&&(0===this.time0&&this.start(),!(0!==this.num_plays&&this.play_counter>=this.num_plays)))for(var t=Date.now()-this.time0;;){var e=this.frames[this.current_frame],i=e.delay_num,s=e.delay_den||100;if(this.frame_time0*s+1e3*i>t*s)break;if(this.frame_time0+=1e3*i/s,this.current_frame++,this.current_frame>=this.num_frames){this.play_counter++,this.setStartFrame();break}var o=this.frames[this.current_frame];1===e.dispose_op&&this.canvas_context.clearRect(0,0,this.canvas.width,this.canvas.height),2===e.dispose_op?this.popCanvas():2===o.dispose_op&&this.pushCanvas(),0===o.blend_op&&this.canvas_context.clearRect(o.x_offset,o.y_offset,o.width,o.height),this.canvas_context.drawImage(o.img,o.x_offset,o.y_offset)}}}class OoBenchmark{constructor(){this.num_rounds=10,this.num_times_digits=8,this.test_function=[],this.test_function_name=[]}addTestFunction(t,e){this.test_function_name.push(t),this.test_function.push(e)}getTime(t,e){var i=performance.now();return e(t),performance.now()-i}run(){var t=Math.pow(10,this.num_times_digits),e=[],i=[];oo.log("test count : "+t);for(var s=0;s<this.num_rounds;s++)oo.log("round : "+s),oo.each(this.test_function,(s,o)=>{e[o]=this.getTime(t,s),i[o]=Math.min(i[o]||e[o],e[o]),oo.log(".."+this.test_function_name[o]+" : "+e[o].toFixed(1))});oo.log("----"),oo.log("weight");var o=[];oo.each(this.test_function,(t,e)=>{o[e]=i[e]-i[0],oo.log(".."+this.test_function_name[e]+" : "+o[e].toFixed(1))}),oo.log("----"),oo.log("ratio"),oo.each(this.test_function,(t,e)=>{oo.log(".."+this.test_function_name[e]+" : "+(o[e]/o[1]).toFixed(2))}),oo.log("----")}}class OoBuffer{constructor(t){this.init(),t&&this.createFixed(t)}init(){this.buffer=null,this.buffer_size=0,this.data_size=0,this.position=0,this.eos=!1,this.auto_grow=!1}release(){this.init()}open(t,e){return this.init(),this.buffer=t,this.buffer_size=e,this.position=0,this.eos=!1,!0}create(t){return this.init(),this.buffer=new Uint8Array(t),this.buffer_size=t,this.auto_grow=!0,!0}createFixed(t){return this.init(),this.buffer=new Uint8Array(t),this.buffer_size=t,!0}createFromBuffer(t,e){return this.create(e),this.write(t,e)==e}growBuffer(t){if(!1===this.auto_grow)return!1;t=t||this.buffer_size;for(var e=new Uint8Array(this.buffer_size+t),i=0;i<this.buffer_size;i++)e[i]=this.buffer[i];return this.buffer=e,this.buffer_size+=t,!0}write(t,e){if(this.auto_grow&&e>this.buffer_size-this.position){var i=e-(this.buffer_size-this.position);this.growBuffer(Math.max(this.buffer_size,i))}for(var s=this.buffer_size-this.position,o=e<s?e:s,a=this.position;a<this.position+o;a++)this.buffer[a]=t[a];return this.position+=o,this.position>=this.buffer_size&&(this.eos=!0),o}writeUint8(t,e){void 0===e&&(e=this.position),this.buffer[e]=255&t}writeUint16(t,e){void 0===e&&(e=this.position),this.buffer[e+0]=t>>>8&255,this.buffer[e+1]=255&t}writeUint32(t,e){void 0===e&&(e=this.position),this.buffer[e+0]=t>>>24&255,this.buffer[e+1]=t>>>16&255,this.buffer[e+2]=t>>>8&255,this.buffer[e+3]=255&t}writeString(t,e){void 0===e&&(e=this.position);for(var i=0;i<t.length;i++)this.buffer[e+i]=t.charCodeAt(i)}readUint8(t){return void 0===t&&(t=this.position),this.buffer[t]}readUint16(t){return void 0===t&&(t=this.position),this.buffer[t]<<8|this.buffer[t+1]}readUint32(t){return void 0===t&&(t=this.position),this.buffer[t+3]<<24|this.buffer[t+2]<<16|this.buffer[t]<<8|this.buffer[t+1]}readString(t,e){void 0===e&&(e=this.position);for(var i="",s=0;s<t;s++)i+=String.fromCharCode(this.buffer[e+s]);return i}}(oo=(oo=oo||{})||{}).env=oo.env||{},oo.env.context=null,oo.env.font_family="'Hiragino Kaku Gothic ProN', 'sans-serif'",oo.blendMode={kNormal:0,kScreen:1,kAdd:2,kMul:3},oo.getCompositeOperationByBlendMode=function(t){let e="source-over";return t===oo.blendMode.kScreen&&(e="screen"),t===oo.blendMode.kAdd&&(e="lighter"),t===oo.blendMode.kMul&&(e="multiply"),e},oo.localAlpha=function(t,e,i){if(0!==e){var s=t.globalAlpha;t.globalAlpha=s*e,i(),t.globalAlpha=s}},oo.localComposite=function(t,e,i){var s=t.globalCompositeOperation;t.globalCompositeOperation=e,i(),t.globalCompositeOperation=s},oo.drawImage=function(t,e,i,s,o,a){if(e){var r=o||e.width,n=a||e.height;t.drawImage(e,i,s,r,n)}},oo.drawImageCenter=function(t,e,i,s,o,a){if(e){var r=o||e.width,n=a||e.height;t.drawImage(e,i-.5*r,s-.5*n,r,n)}},oo.drawPatchImage=function(t,e,i,s,o,a){if(e)for(var r=(e.width-2)/2,n=(e.height-2)/2,h=[0,r,r+2],c=[0,n,n+2],u=[r,2,r],l=[n,2,n],_=[i,i+r,i+o-r],d=[s,s+n,s+a-n],f=[r,o-2*r,r],p=[n,a-2*n,n],m=0;m<3;m++)for(var g=0;g<3;g++)t.drawImage(e,h[g],c[m],u[g],l[m],_[g],d[m],f[g],p[m])},oo.drawRoundRect=function(t,e,i,s,o,a,r,n){var h=void 0===a?5:a;void 0===n&&(n=!0),t.beginPath(),t.moveTo(e+h,i),t.lineTo(e+s-h,i),t.quadraticCurveTo(e+s,i,e+s,i+h),t.lineTo(e+s,i+o-h),t.quadraticCurveTo(e+s,i+o,e+s-h,i+o),t.lineTo(e+h,i+o),t.quadraticCurveTo(e,i+o,e,i+o-h),t.lineTo(e,i+h),t.quadraticCurveTo(e,i,e+h,i),t.closePath(),r&&t.fill(),n&&t.stroke()},oo.setTextAttributes=function(t,e,i,s,o){t.font=`${e}px `+oo.env.font_family,t.fillStyle=i,t.textAlign=s,t.textBaseline=o};var oo,resizeCanvasDrawImage=function(t,e,i,s){var o=document.getElementById(t);o.width=i.w*s,o.height=i.h*s,o.getContext("2d").drawImage(e,i.x,i.y,i.w,i.h,0,0,i.w*s,i.h*s)},saveCanvasImage=function(t,e,i,s){var o=document.getElementById(t),a=document.createElement("a");"jpg"===i&&(a.href=o.toDataURL("image/jpeg",s)),"png"===i&&(a.href=o.toDataURL("image/png")),a.download=e+"."+i,a.click()};(oo=oo||{}).base16={},oo.base16.encode=function(t){var e="";for(var i of t)e+=("0"+i.toString(16)).slice(-2);return e},oo.base16.decode=function(t){for(var e=[],i=t.length/2,s=0;s<i;s++)e[s]=Number.parseInt(t.substr(2*s,2),16);return e},oo.utf8bin={},oo.utf8bin.encode=function(t){for(var e=[],i=t.length,s=0;s<i;s++){var o=t.charCodeAt(s);if(o>=55296&&o<56320){s++;var a=t.charCodeAt(s);a>=56320&&a<57344&&(o=(o-55296&16383)<<10|a-56320&16383,o+=65536)}if(0===o)break;o<128?e.push(o):o<2048?(e.push(o>>6|192),e.push(63&o|128)):o<65536?(e.push(o>>12|224),e.push(o>>6&63|128),e.push(63&o|128)):(e.push(o>>18|240),e.push(o>>12&63|128),e.push(o>>6&63|128),e.push(63&o|128))}return e},oo.utf8bin.decode=function(t){for(var e="",i=t.length,s=0;s<i;s++){var o=t[s];if(0===o)break;o<128?o&=127:o<224?(o=(31&o)<<6,o|=63&t[s+1],s+=1):o<240?(o=(15&o)<<12,o|=(63&t[s+1])<<6,o|=63&t[s+2],s+=2):(o=(7&o)<<18,o|=(63&t[s+1])<<12,o|=(63&t[s+2])<<6,o|=63&t[s+3],s+=3),o<65536?e+=String.fromCharCode(o):(o-=65536,e+=String.fromCharCode(o>>>10|55296),e+=String.fromCharCode(16383&o|56320))}return e},(oo=oo||{}).env=oo.env||{},oo.env.debug_log=!1,oo.env.main_proc=null,oo.env.sample_text="The quick brown fox jumps over the lazy dog.",oo.isObject=function(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)},oo.isArray=function(t){return Array.isArray(t)},oo.isFunction=function(t){return"function"==typeof t},oo.qq=function(t,e){return void 0!==t?t:e},oo.xx=function(t,...e){t&&t(...e)},oo.each=function(t,e,...i){if(Array.isArray(t)){if("string"==typeof e)for(var s of t)s[e].apply(s,i);if("function"==typeof e)for(var o=0;o<t.length;o++)e.call({},t[o],o,t)}},oo.repeat=function(t,e){for(var i=0;i<t;i++)e(i)},oo.find=function(t,e){return e.indexOf(t)>=0},oo.clone=function(t){return Object.assign({},t)},oo.deepClone=function(t){if("object"!=typeof t)return t;if(null===t)return null;if(Array.isArray(t)){var e=[];for(var i of t)e.push(oo.deepClone(i));return e}var s={},o=Object.keys(t);for(var a of o)s[a]=oo.deepClone(t[a]);return s},oo.main=function(t){oo.env.main_proc=t,document.addEventListener("DOMContentLoaded",function(){t()},!1)},(oo=oo||{}).crc=oo.crc||{},oo.crc.kPolynomial=3988292384,oo.crc.initialized=!1,oo.crc.table=new Array(256);class OoCrc{constructor(){oo.crc.initialized||(OoCrc._makeCrcTable(),oo.crc.initialized=!1)}static _makeCrcTable(){for(var t=0;t<256;t++){for(var e=t,i=0;i<8;i++)e=1&e?e>>>1^oo.crc.kPolynomial:e>>>1;oo.crc.table[t]=e}}getCrc(t,e,i,s){void 0===s&&(s=0),s^=4294967295;for(var o=0;o<i;o++)s=s>>>8^oo.crc.table[255&s^t[e+o]];return 4294967295^s}static get(t,e,i){return(new OoCrc).getCrc(t,e,i,0)}}oo.csvToArray2=function(t){for(var e=t.length,i=!1,s="",o=[],a=[],r=0;r<e;r++){var n=t.charAt(r);if('"'!==n){if(!i){if(","===n){a.push(s),s="";continue}if("\n"===n){(s.length||a.length)&&(a.push(s),s=""),a.length&&(o.push(a),a=[]);continue}}s+=n}else i?r+1<e&&'"'===t.charAt(r+1)?(s+='"',r+=1):i=!1:i=!0}return s.length&&a.push(s),a.length&&o.push(a),o},oo.csvToObjectArray=function(t){for(var e=[],i=oo.csvToArray2(t),s=1;s<i.length;s++){for(var o={},a=0;a<i[s].length;a++)o[i[0][a]]=i[s][a];e.push(o)}return e},oo.backSlashToSlash=function(t){for(var e="",i=0;i<t.length;i++){var s=t.charAt(i);e+="\\"===s?"/":s}return e},oo.addPath=function(t,e){return"/"!==t.substr(-1)&&(t+="/"),t+e},oo.getFolder=function(t){var e=(t=oo.backSlashToSlash(t)).lastIndexOf("/");return t.substr(0,e+1)},oo.getFilename=function(t){var e=(t=oo.backSlashToSlash(t)).lastIndexOf("/");return t.substr(e+1)},oo.getNonExtension=function(t){var e=(t=oo.backSlashToSlash(t)).lastIndexOf(".");return e<0?t:t.substr(0,e)},oo.saveBlob=function(t,e){var i=document.createElement("a");i.href=URL.createObjectURL(e),i.download=t,i.click()},oo.saveBin=function(t,e){var i=new Uint8Array(e);oo.saveBlob(t,new Blob([i]))},oo.saveText=function(t,e){oo.saveBlob(t,new Blob([e],{type:"text/plain"}))},oo.loadText=function(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onreadystatechange=function(){4===i.readyState&&(0!==i.status&&200!==i.status||e(i.response))},i.send("")},(oo=oo||{}).fxsRotationType={kNormal:0,kDirection:1},oo.fxsDirectionType={kNormal:0,kSphere:1,kDist:2,kCenter:3},oo.fxsDistributionType={kNone:0,kUniform:1,kBall:2,kSphere:3};class OoFxsLerpParam{constructor(t,e,i){this.a=void 0===t?0:t,this.b=void 0===e?0:e,this.p=void 0===i?0:i}}class OoFxsEmitterFrame{constructor(){this.frame_num=0,this.num_ppf=0,this.life_time=0,this.life_time_dist=0,this.direction_type=oo.fxsDirectionType.kNormal,this.direction=new Oo3DVector(0),this.direction_dist=0,this.velocity0=0,this.velocity1=0,this.distribution_type=oo.fxsDistributionType.kNone,this.position=new Oo3DVector(0),this.position_dist=new Oo3DVector(0),this.scale0=1,this.scale1=1,this.rotation0=0,this.rotation1=0,this.rotate_v0=0,this.rotate_v1=0,this.frame_offset_dist=0}}class OoFxsParticleFrame{constructor(){this.frame_num=0,this.scale=new Oo2DVector(1),this.alpha=1}}class OoFxsTypeBase{constructor(){this.frame_data=[],this.frame_lerp_array=[]}createFrameLerpArray(){for(var t=this.frame_data.length,e=0,i=0,s=0,o=0;o<t;o++){for(;e<this.frame_data[o].frame_num;e++){var a=this.frame_data[i].frame_num,r=this.frame_data[s].frame_num,n=oo.linearStep(a,r,e);this.frame_lerp_array[e]=new OoFxsLerpParam(i,s,n)}i=s,s=Math.min(s+1,t-1)}this.frame_lerp_array[e]=new OoFxsLerpParam(s,s,0)}getFrameLerpParam(t){if(t<0)return this.frame_lerp_array[0];var e=this.frame_lerp_array.length;return t>=e?this.frame_lerp_array[e-1]:this.frame_lerp_array[t]}getFrameData(t){var e=this.getFrameLerpParam(t);return this.frame_data[e.a]}}class OoFxsParticleType extends OoFxsTypeBase{constructor(t){super(),this.id="",this.loop=!1,this.total_frames=0,this.size=new Oo2DVector(1),this.center=new Oo2DVector(0),this.texture_file="",this.world=!1,oo.isObject(t)&&Object.assign(this,t)}getFrameData(t){var e=this.getFrameLerpParam(t),i=this.frame_data[e.a],s=this.frame_data[e.b],o=new OoFxsParticleFrame;return o.frame_num=t,o.alpha=oo.lerp(i.alpha,s.alpha,e.p),o.scale.x=oo.lerp(i.scale.x,s.scale.x,e.p),o.scale.y=oo.lerp(i.scale.y,s.scale.y,e.p),o}}class OoFxsEmitterType extends OoFxsTypeBase{constructor(t){super(),this.id="",this.loop=!1,this.total_frames=0,this.particle_name="",this.max_particles=0,oo.isObject(t)&&Object.assign(this,t)}}class OoFxsEmitterStatus{constructor(){this.show=!0,this.current_frame=-1,this.num_particles=0,this.emitter_type=null,this.particle_type=null,this.particle_status_array=[]}}class OoFxsParticleStatus{constructor(){this.current_frame=0,this.life_time=0,this.position=new Oo3DVector(0),this.velocity=new Oo3DVector(0),this.size=new Oo2DVector(1),this.scale=new Oo2DVector(1),this.rotation=0,this.rotate_v=0}}class OoFxs{constructor(){this.position=new Oo3DVector(0),this.random=new OoRandom}generateParticle(t,e,i){t.current_frame=-1,t.current_frame+=Math.floor(e.frame_offset_dist*Math.random()),t.life_time=e.life_time,t.position.set(e.position),e.distribution_type===oo.fxsDistributionType.kUniform&&(t.position.x+=e.position_dist.x*(2*Math.random()-1),t.position.y+=e.position_dist.y*(2*Math.random()-1),t.position.z+=e.position_dist.z*(2*Math.random()-1)),i.world&&t.position.add(this.position);var s=oo.lerp(e.velocity0,e.velocity1,Math.random());if(e.direction_type===oo.fxsDirectionType.kNormal&&(t.velocity.x=e.direction.x*s,t.velocity.y=e.direction.y*s,t.velocity.z=e.direction.z*s),e.direction_type===oo.fxsDirectionType.kSphere){var o=this.random.getSphere();t.velocity.x=o.x*s,t.velocity.y=o.y*s,t.velocity.z=o.z*s}var a=oo.lerp(e.scale0,e.scale1,Math.random());t.size.x=i.size.x*a,t.size.y=i.size.y*a,t.rotation=oo.lerp(e.rotation0,e.rotation1,Math.random()),t.rotate_v=oo.lerp(e.rotate_v0,e.rotate_v1,Math.random())}create(t,e){var i=new OoFxsEmitterStatus;i.emitter_type=t,i.particle_type=e,this.emitter_status=i,i.particle_status_array=[];for(var s=0;s<t.max_particles;s++)i.particle_status_array[s]=new OoFxsParticleStatus}update(){var t=this.emitter_status,e=t.emitter_type;t.current_frame++,e.loop&&(t.current_frame%=e.total_frames);var i=e.getFrameData(t.current_frame);let s=0;for(let e=0;e<t.num_particles;e++)t.particle_status_array[e].life_time<=0||(e!==s&&(t.particle_status_array[s]=t.particle_status_array[e]),s++);t.num_particles=s,t.particle_status_array.length=s;var o=t.num_particles;let a=i.num_ppf;a<1&&Math.random()<a&&(a=1),a=Math.floor(a);for(let s=0;s<a&&!(t.num_particles>=e.max_particles);s++)t.particle_status_array[o+s]=new OoFxsParticleStatus,this.generateParticle(t.particle_status_array[o+s],i,t.particle_type),t.num_particles++;for(let e=0;e<t.num_particles;e++){var r=t.particle_status_array[e];r.current_frame++;var n=t.particle_type.getFrameData(r.current_frame);r.life_time--,r.position.add(r.velocity),r.scale.set(n.scale),r.rotation+=r.rotate_v}}draw(t){t.save();for(var e=0;e<this.emitter_status.num_particles;e++){var i=this.emitter_status.particle_status_array[e],s=this.particle_type,o=i.size.x*i.scale.x,a=i.size.y*i.scale.y,r=i.position.x,n=i.position.y;s.world||(r+=this.position.x,n+=this.position.y),t.setTransform(1,0,0,1,0,0),t.translate(r,n),t.rotate(i.rotation*Math.PI/180),t.drawImage(this.image,-o*(.5+s.center.x),-a*(.5+s.center.y),o,a)}t.restore()}}class OoGameAnime{constructor(){this.times=30,this.counter=-1,this.effects=new Set,this.overwrite_effect=!1,this.overwrite_alpha=0,this.overwrite_blend_mode=oo.blendMode.kNormal,this.tile_effect=!1,this.tile_alpha=0,this.tile_color="#000000",this.scale=new Oo2DVector(1,1)}init(){this.counter=-1,this.effects.clear(),this.overwrite_effect=!1,this.overwrite_alpha=0,this.overwrite_blend_mode=oo.blendMode.kNormal,this.tile_effect=!1,this.tile_alpha=0,this.scale.set(1,1)}start(t){this.counter=0,this.effects.add(t)}onCompletion(){}update(){if(this.counter>=0){for(var t of this.effects)this[t].call(this);this.counter++,this.counter>=this.times&&(this.onCompletion(),this.init())}}pop(){this.scale.x=Math.pow(2,oo.attenuatedSineWave(this.counter,0,this.times,1,.1)),this.scale.y=Math.pow(2,oo.attenuatedSineWave(this.counter,0,this.times,1,.1))}push(){this.scale.x=Math.pow(2,-oo.attenuatedSineWave(this.counter,0,this.times,1.5,.1)),this.scale.y=Math.pow(2,oo.attenuatedSineWave(this.counter,0,this.times,1.5,.2))}add(){this.overwrite_effect=!0,this.overwrite_alpha=oo.attenuatedSineWave(this.counter,0,this.times,.5,.5),this.overwrite_blend_mode=oo.blendMode.kAdd}mul(){this.overwrite_effect=!0,this.overwrite_alpha=oo.attenuatedSineWave(this.counter,0,this.times,.5,.5),this.overwrite_blend_mode=oo.blendMode.kMul}tile(){this.tile_effect=!0,this.tile_alpha=oo.attenuatedSineWave(this.counter,0,this.times,.5,.5)}light(){this.add()}dark(){this.mul()}}class OoGameButton{constructor(t,e,i,s,o,a){this.context=null,this.show=!0,this.name=t,this.enable=!0,this.position=new Oo2DVector(e,i),this.size=new Oo2DVector(s,o),this.image=a,this.patch_image=!1,this.anime=new OoGameAnime,this.anime.onCompletion=(()=>{this.onCompletion()})}contains(t){var e=this.position.x-t.x,i=this.position.y-t.y;return!(Math.abs(e)>.5*this.size.x)&&!(Math.abs(i)>.5*this.size.y)}onClick(){}onCompletion(){}click(t){return!!this.contains(t)&&(this.onClick(),!0)}startAnime(t){this.anime.start(t)}update(){this.anime.update()}_drawCore(t){var e=this.size.x*this.anime.scale.x,i=this.size.y*this.anime.scale.y;this.patch_image?oo.drawPatchImage(t,this.image,this.position.x-.5*e,this.position.y-.5*i,e,i):oo.drawImage(t,this.image,this.position.x-.5*e,this.position.y-.5*i,e,i)}draw(t){if(this.show){var e=t||this.context||oo.env.context;this.image&&(this._drawCore(e),this.anime.overwrite_effect&&oo.localAlpha(e,this.anime.overwrite_alpha,()=>{var t=oo.getCompositeOperationByBlendMode(this.anime.overwrite_blend_mode);oo.localComposite(e,t,()=>{this._drawCore(e)})})),this.anime.tile_effect&&oo.localAlpha(e,this.anime.tile_alpha,()=>{e.fillStyle=this.anime.tile_color;var t=this.size.x*this.anime.scale.x,i=this.size.y*this.anime.scale.y;e.fillRect(this.position.x-.5*t,this.position.y-.5*i,t,i)})}}}(oo=oo||{}).env=oo.env||{},oo.env.os="";class OoGameFrame{constructor(){this.game_loop_type=2,this.fps=60,this.horizontal_scaling=!1,this.vertical_scaling=!1,this.screen_width=1080,this.screen_height=1920,this.scale=1,this.canvas,this.context,this.scene_array=[],this.scene_map=new Map,this.click_on=!1,this.click_position=new Oo2DVector(0),this.input=new OoGameInput,this.touch_on=!1,this.touch_press=!1,this.touch_position=new Oo2DVector(0),this.touch_delta=new Oo2DVector(0);try{this.audio_context=new AudioContext}catch(t){console.log("oo:new AudioContext() exception")}}addScene(t){t.frame=this,this.scene_array.push(t),this.scene_map.set(t.name,t)}startScene(t){this.setSceneStatus(t,oo.gameSceneStatus.kStart)}endScene(t){this.setSceneStatus(t,oo.gameSceneStatus.kEnd)}getScene(t){return this.scene_map.get(t)}setSceneStatus(t,e){var i=this.getScene(t);i&&(i.scene_status=e)}update(){var t=new OoGameInputStatus;for(var e of(t.touch_press=this.touch_press||this.touch_on,t.touch_position=this.touch_position.clone(),this.input.addStatus(t),this.touch_on=!1,this.touch_delta=new Oo2DVector(0),this.scene_array))e.scene_status===oo.gameSceneStatus.kActive&&e.update();for(e of this.scene_array)e.scene_status===oo.gameSceneStatus.kEnd&&(e.release(),e.scene_status=oo.gameSceneStatus.kInactive);for(e of this.scene_array)e.scene_status===oo.gameSceneStatus.kStart&&(e.create(),e.update(),e.scene_status=oo.gameSceneStatus.kActive)}render(){for(var t of this.scene_array)t.scene_status===oo.gameSceneStatus.kActive&&t.render();this.click_on=!1}setHorizontalScaling(){this.horizontal_scaling=!0}setVerticalScaling(){this.vertical_scaling=!0}setCanvasScaleWH(t,e,i){this.scale=Math.min(e/this.screen_width,i/this.screen_height),this.horizontal_scaling&&(this.scale=e/this.screen_width),this.vertical_scaling&&(this.scale=i/this.screen_height);var s=this.screen_width,o=this.screen_height;this.horizontal_scaling&&(o=Math.floor(this.screen_width*i/e)),this.vertical_scaling&&(s=Math.floor(this.screen_height*e/i)),t.width=s,t.height=o}createDrawEnv(t){t?this.setCanvasScaleWH(t,t.clientWidth,t.clientHeight):(oo.env.debug_log&&console.log("createDrawEnv:create canvas"),t=document.createElement("canvas"),document.body.appendChild(t),this.setCanvasScaleWH(t,document.body.clientWidth,document.body.clientHeight),t.style.width=Math.floor(t.width*this.scale)+"px",t.style.height=Math.floor(t.height*this.scale)+"px",t.style.position="absolute",t.style.backgroundColor="#000000",t.style.zIndex=1),this.canvas=t,this.context=t.getContext("2d")}clear(){"android"===oo.env.os?this.context.clearRect(0,0,this.canvas.width+1,this.canvas.height+1):this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}setupInput(){var t=this,e=this.canvas;function i(i){var s=e.getBoundingClientRect(),o=(i.clientX-s.left)/t.scale,a=(i.clientY-s.top)/t.scale;return new Oo2DVector(o,a)}function s(i){var s=e.getBoundingClientRect(),o=(i.changedTouches[0].pageX-s.left)/t.scale,a=(i.changedTouches[0].pageY-s.top)/t.scale;return new Oo2DVector(o,a)}function o(e){e.preventDefault(),e.stopPropagation(),t.touch_press&&(t.touch_position=s(e)),t.touch_press=!1}"ontouchstart"in window?e.addEventListener("touchend",function(i){var s=e.getBoundingClientRect();t.click_on=!0,t.click_position.x=(i.changedTouches[0].pageX-s.left)/t.scale,t.click_position.y=(i.changedTouches[0].pageY-s.top)/t.scale},!1):e.addEventListener("click",function(i){var s=e.getBoundingClientRect();t.click_on=!0,t.click_position.x=(i.clientX-s.left)/t.scale,t.click_position.y=(i.clientY-s.top)/t.scale},!1),"ontouchstart"in window?(e.addEventListener("touchstart",function(e){e.preventDefault(),e.stopPropagation(),1===e.touches.length?(t.touch_press=!0,t.touch_on=!0,t.touch_position=s(e),t.touch_delta.set(0,0),t.touch_path_length=0):t.touch_press=!1},!1),e.addEventListener("touchmove",function(i){if(i.preventDefault(),i.stopPropagation(),t.touch_press){var o=s(i);t.touch_delta.add(o).sub(t.touch_position),t.touch_position=o,o.x<0&&(t.touch_press=!1),o.y<0&&(t.touch_press=!1),o.x>=e.width&&(t.touch_press=!1),o.y>=e.height&&(t.touch_press=!1)}},!1),e.addEventListener("touchend",o,!1),e.addEventListener("touchcancel",o,!1)):(e.addEventListener("mousedown",function(e){t.touch_press=!0,t.touch_on=!0,t.touch_position=i(e),t.touch_delta.set(0,0),t.touch_path_length=0},!1),e.addEventListener("mousemove",function(e){var s=i(e);t.touch_delta.add(s).sub(t.touch_position),t.touch_position=s},!1),e.addEventListener("mouseup",function(e){t.touch_press=!1,t.touch_position=i(e)},!1))}setupGameLoop(){var t=this,e=this.fps;if(0===this.game_loop_type&&setInterval(function(){t.update(),t.render()},1e3/e),1===this.game_loop_type&&setTimeout(function i(){setTimeout(i,1e3/e),t.update(),t.render()},1e3/e),2===this.game_loop_type&&requestAnimationFrame(function e(){requestAnimationFrame(e),t.update(),t.render()}),3===this.game_loop_type){var i=Date.now(),s=0;setInterval(function(){var o=Date.now(),a=o-i;if(!(a<1e3/e)){if(i=o-Math.min(a-1e3/e,8),s){if((s+=1)<60)return;cancelAnimationFrame(r)}s=1;var r=requestAnimationFrame(()=>{t.update(),t.render(),s=0})}},8)}}}class OoGameInputStatus{constructor(){this.touch_press=!1,this.touch_position=new Oo2DVector(0),this.touch_delta=new Oo2DVector(0)}}class OoGameInput{constructor(){this.click_on=!1,this.click_position=new Oo2DVector(0),this.status_array=[],this.status_array[0]=new OoGameInputStatus,this.status_array[1]=new OoGameInputStatus,this._element=document,this._scale=1,this._click_on=!1,this._click_position=new Oo2DVector(0),this._touch_on=!1,this._touch_press=!1,this._touch_position=new Oo2DVector(0),this._touch_delta=new Oo2DVector(0),this._touch_path_length=0}addStatus(t){this.status_array.pop(),this.status_array.unshift(t)}getTouchPosition(){return this.status_array[0].touch_position}getTouchDelta(){return this.status_array[0].touch_delta}isTouch(){return!0===this.status_array[0].touch_press}isTouchStart(){return!0===this.status_array[0].touch_press&&!1===this.status_array[1].touch_press}isTouchEnd(){return!1===this.status_array[0].touch_press&&!0===this.status_array[1].touch_press}setup(t,e){t&&(this._element=t),e&&(this._scale=e),"ontouchstart"in window?(this._element.addEventListener("touchend",t=>this._tapListener(t),!1),this._element.addEventListener("touchstart",t=>this._onTouchStart(t),!1),this._element.addEventListener("touchmove",t=>this._onTouchMove(t),!1),this._element.addEventListener("touchend",t=>this._onTouchEnd(t),!1),this._element.addEventListener("touchcancel",t=>this._onTouchEnd(t),!1)):(this._element.addEventListener("click",t=>this._clickListener(t),!1),this._element.addEventListener("mousedown",t=>this._onMouseDown(t),!1),this._element.addEventListener("mousemove",t=>this._onMouseMove(t),!1),this._element.addEventListener("mouseup",t=>this._onMouseUp(t),!1))}update(){var t=new OoGameInputStatus;t.touch_press=this._touch_press||this._touch_on,t.touch_position=this._touch_position.clone(),t.touch_delta=this._touch_delta.clone(),this.addStatus(t),this.click_on=this._click_on,this.click_position=this._click_position.clone(),this._touch_on=!1,this._click_on=!1,this._touch_delta=new Oo2DVector(0)}_getEventPositionMouse(t){var e=this._element.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top;return Oo2DVector.create(i,s).mul(this._scale)}_getEventPositionTouch(t){var e=this._element.getBoundingClientRect(),i=(t.changedTouches[0].pageX-e.left)*this._scale,s=(t.changedTouches[0].pageY-e.top)*this._scale;return new Oo2DVector(i,s)}_clickListener(t){this._click_on=!0,this._click_position=this._getEventPositionMouse(t)}_tapListener(t){this._touch_press&&(this._click_on=!0,this._click_position=this._getEventPositionTouch(t))}_onTouchStart(t){1===t.touches.length?(this._touch_press=!0,this._touch_on=!0,this._touch_position=this._getEventPositionTouch(t),this._touch_delta.set(0,0),this._touch_path_length=0):this._touch_press=!1}_onTouchMove(t){var e=this._element.getBoundingClientRect(),i=t.changedTouches[0].pageX,s=t.changedTouches[0].pageY;if((i<e.left||i>=e.right||s<e.top||s>=e.bottom)&&(this._touch_press=!1),this._touch_press){var o=this._getEventPositionTouch(t);this._touch_delta.add(o).sub(this._touch_position),this._touch_path_length+=Oo2DVector.distance(o,this._touch_position),this._touch_position=o}this._touch_position=new Oo2DVector(i,s),t.preventDefault(),t.stopPropagation()}_onTouchEnd(t){this._touch_press&&(this._touch_press=!1,this._touch_position=this._getEventPositionTouch(t))}_onMouseDown(t){this._touch_press=!0,this._touch_on=!0,this._touch_position=this._getEventPositionMouse(t),this._touch_delta.set(0,0),this._touch_path_length=0}_onMouseMove(t){var e=this._getEventPositionMouse(t);this._touch_delta.add(e).sub(this._touch_position),this._touch_path_length+=Oo2DVector.distance(e,this._touch_position),this._touch_position=e}_onMouseUp(t){this._touch_press=!1,this._touch_position=this._getEventPositionMouse(t)}}class OoGameLayoutCell{constructor(){this.show=!0,this.name="",this.parent="",this.order=0,this.alpha=1,this.align=0,this.x=0,this.y=0,this.w=0,this.h=0,this.border=!1,this.text="",this.fontsize=0,this.color="#000000",this.bold=!1,this.wrap=!1,this.image="",this.img=null,this.rect=new OoRect}updateRect(t){this.rect||(this.rect=new OoRect(0,0,t.screen_width,t.screen_height));var e=t.cell_map.get(this.parent);if(e){var i=e.getAlignedRect(t);i&&this.rect.set(i)}}getAlignedRect(t){this.rect||this.updateRect(t);var e=new OoRect(this.x,this.y,this.w,this.h);return oo.alignedRect(this.rect,e,this.align)}getImageRect(){if(this.img){var t=new OoRect(this.x,this.y,this.img.width,this.img.height);return oo.alignedRect(this.rect,t,this.align)}}draw(t,e,i){var s=void 0===e?0:e,o=void 0===i?0:i,a=t.globalAlpha;if(this.alpha<1&&(t.globalAlpha=a*this.alpha),this.border){var r=new OoRect(this.x,this.y,this.w,this.h),n=oo.alignedRect(this.rect,r,this.align);t.strokeStyle=this.color,t.beginPath(),t.strokeRect(n.x+s,n.y+o,n.w,n.h)}if(this.img&&this.img.width){var h=new OoRect(this.x,this.y,this.img.width,this.img.height);n=oo.alignedRect(this.rect,h,this.align),t.drawImage(this.img,n.x+s,n.y+o)}if(this.text){var c="";this.bold&&(c+="bold "),c+=this.fontsize+"px ",c+=" ''",t.font=c,t.fillStyle=this.color,t.textAlign="left",t.textBaseline="top";var u=oo.clamp(this.align,1,9),l=new OoRect(this.x,this.y,0,0);n=oo.alignedRect(this.rect,l,u);t.textAlign=["left","center","right"][(u+2)%3],t.textBaseline=["top","middle","bottom"][Math.floor((u-1)/3)],t.fillText(this.text,n.x+s,n.y+o)}t.globalAlpha=a}}class OoGameLayout{constructor(){this.layout_name="",this.image_base_path="",this.display_width=108,this.display_height=192,this.screen_width=1080,this.screen_height=1920,this.cells=[],this.cell_map=new Map,this.cell_order=[],this.offset=new Oo2DVector(0),this.context}draw(t){var e=t||this.context||oo.env.context;for(var i of(0===this.cell_order.length&&(this.cell_order=this.cells.slice()),this.cell_order))i.rect||i.updateRect(this),i.show&&i.draw(e,this.offset.x,this.offset.y)}drawCell(t,e){var i=e||this.context||oo.env.context,s=this.getCell(t);s.rect||s.updateRect(this),s.draw(i,this.offset.x,this.offset.y)}updateCellMap(){for(var t of(this.cell_map.clear(),this.cells))t.name&&this.cell_map.set(t.name,t)}updateCoordinate(){for(var t of this.cells)t.rect=null;for(t of this.cells)t.updateRect(this)}updateOrder(){this.cell_order=this.cells.slice(),oo.sort(this.cell_order,function(t,e){return t.order>e.order?1:0})}getCell(t){return this.cell_map.get(t)}getCellImage(t){return this.cell_map.get(t).img}loadJson(t){var e=JSON.parse(t);this.loadJsonObj(e)}loadJsonObj(t){for(var e of(this.layout_name=t.layout_name,this.image_base_path=t.image_base_path,this.display_width=t.display_width,this.display_height=t.display_height,this.screen_width=t.screen_width,this.screen_height=t.screen_height,t.cells)){var i=new OoGameLayoutCell;Object.assign(i,e),this.cells.push(i)}this.updateCellMap(),this.updateCoordinate(),this.updateOrder()}asyncLoadImage(){var t=this;oo.parallel(function*(){for(var e of t.cells)if(e.image){let i=oo.addPath(t.image_base_path,e.image);e.img=yield oo.xnCreateImage(i)}})}asyncSetupFromFile(t,e){var i=this;oo.serial(function*(){var t=yield oo.xnLoadText(e);i.loadJson(t.text),yield i.asyncLoadImage()})}}(oo=(oo=oo||{})||{}).gameSceneStatus={kInactive:0,kActive:1,kStart:2,kEnd:3};class OoGameScene{constructor(){this.frame=null,this.name="",this.scene_status=oo.gameSceneStatus.kInactive,this.next_scene="",this.scene_end=!1,this.fade_times=60,this.fade_counter=0,this.fade_alpha=0}release(){}preload(){}create(){}update(){}render(){}changeSceneOnFadeOut(){""!==this.next_scene&&(this.frame.endScene(this.name),this.frame.startScene(this.next_scene))}fadeIn(){this.fade_counter=-this.fade_times,this.setFadeAlpha()}fadeOut(){this.fade_counter=1,this.setFadeAlpha()}setFadeAlpha(){this.fade_alpha=oo.saturate(Math.abs(this.fade_counter/this.fade_times))}updateFade(){this.setFadeAlpha(),0!==this.fade_counter&&this.fade_counter++,this.fade_counter===this.fade_times+2&&this.changeSceneOnFadeOut()}renderFade(){this.frame.canvas.style.opacity=1-this.fade_alpha}}class OoGameScroll{constructor(){this.touch_pos=new Oo2DVector(0,0),this.pos_delta=[],this.pos_delta[0]=new Oo2DVector(0,0),this.pos_delta[1]=new Oo2DVector(0,0),this.velocity=new Oo2DVector(0,0),this.offset=new Oo2DVector(0,0),this.y_min=0,this.y_max=1e3,this.x_min=0,this.x_max=1e3,this.resistance=3,this.attenuation=.95,this.attenuation_out=.95,this.resilience=.9}update(t){t.isTouchStart()&&(this.touch_pos=t.getTouchPosition()),t.isTouch()&&(this.pos_delta[1]=this.pos_delta[0],this.pos_delta[0]=Oo2DVector.sub(t.getTouchPosition(),this.touch_pos),this.touch_pos=t.getTouchPosition(),this.velocity.x=.5*(this.pos_delta[0].x+this.pos_delta[1].x),this.velocity.y=.5*(this.pos_delta[0].y+this.pos_delta[1].y));var e=this.velocity.x,i=this.velocity.y;return this.offset.x>=this.x_min&&this.offset.x+e<=this.x_min&&(e-=this.x_min-this.offset.x),this.offset.x<=this.x_max&&this.offset.x+e>=this.x_max&&(e-=this.x_max-this.offset.x),this.offset.x<=this.x_min&&this.velocity.x<0&&(e/=this.resistance),this.offset.x>=this.x_max&&this.velocity.x>0&&(e/=this.resistance),this.offset.y>=this.y_min&&this.offset.y+i<=this.y_min&&(i-=this.y_min-this.offset.y),this.offset.y<=this.y_max&&this.offset.y+i>=this.y_max&&(i-=this.y_max-this.offset.y),this.offset.y<=this.y_min&&this.velocity.y<0&&(i/=this.resistance),this.offset.y>=this.y_max&&this.velocity.y>0&&(i/=this.resistance),this.offset.x+=e,this.offset.y+=i,t.isTouch()||(this.velocity.mul(this.attenuation),this.offset.x<=this.x_min&&this.velocity.x<0&&(this.velocity.x*=this.attenuation_out),this.offset.x>=this.x_max&&this.velocity.x>0&&(this.velocity.x*=this.attenuation_out),this.offset.y<=this.y_min&&this.velocity.y<0&&(this.velocity.y*=this.attenuation_out),this.offset.y>=this.y_max&&this.velocity.y>0&&(this.velocity.y*=this.attenuation_out),this.offset.x<this.x_min&&(this.offset.x=(this.offset.x-this.x_min)*this.resilience+this.x_min),this.offset.x>this.x_max&&(this.offset.x=(this.offset.x-this.x_max)*this.resilience+this.x_max),this.offset.y<this.y_min&&(this.offset.y=(this.offset.y-this.y_min)*this.resilience+this.y_min),this.offset.y>this.y_max&&(this.offset.y=(this.offset.y-this.y_max)*this.resilience+this.y_max)),this.getOffset()}getOffset(){return this.offset}}(oo=oo||{}).kPi=3.141592653589793,oo.k2Pi=6.283185307179586,oo.kPi2=1.5707963267948966,oo.kInvPi=.3183098861837907,oo.kDeg2Rad=.017453292519943295,oo.kRad2Deg=57.29577951308232,oo.kE=2.718281828459045,oo.clamp=function(t,e,i){return t<e?e:t>i?i:t},oo.square=function(t){return t*t},oo.lerp=function(t,e,i){return(1-i)*t+i*e},oo.saturate=function(t){return t<0?0:t>1?1:t},oo.linearStep=function(t,e,i){return t===e?0:oo.saturate((i-t)/(e-t))},oo.smoothStep=function(t,e,i){var s=oo.linearStep(t,e,i);return s*s*(3-2*s)},oo.sigmoid=function(t){return 1/(1+Math.exp(-t))},oo.sigmoidStep=function(t,e){if(t<=0)return 0;if(t>=1)return 1;var i=2*t-1,s=1/(1+Math.exp(-i*e)),o=Math.exp(-e);return(1+o)/(1-o)*(s-.5)+.5},oo.sineStep=function(t){return.5-.5*Math.cos(t*Math.PI)},oo.attenuatedSineWave=function(t,e,i,s,o){var a=1-t/(i-e),r=s*oo.k2Pi*t/(i-e);return a*Math.sin(r)*o},oo.getIntersectionPoint=function(t,e,i,s){if(!(Oo2DVector.distance(t,i)>e+s)){var o=Oo2DVector.lerp(t,i,e/(e+s)),a=Oo2DVector.distance(t,o),r=Math.sqrt(e*e-a*a),n=Oo2DVector.sub(i,t).rotate90().normalize().mul(r);return[o.clone().add(n),o.clone().sub(n)]}},(oo=oo||{}).drawPointLightImage=function(t,e,i,s,o){for(var a,r,n,h,c=t.size.x,u=t.size.y,l=t.size.clone().mul(.5).sub(.5),_=i.clone().div(t.size),d=Oo2DVector.create(2,2).div(t.size),f=function(t){var e=Math.sqrt(t),i=1;return-1===o&&(i=1/Math.sqrt(e)),1===o&&(i=1/e),2===o&&(i=1/t),i},p=f(oo.square(.5*Math.min(i.x,i.y))),m=0;m<u;m++)for(var g=0;g<c;g++){var v=Oo2DVector.create(g,m).sub(l),y=v.clone().mul(_),x=p*v.clone().mul(d).getMagnitude(),w=(f(y.getMagnitudeSquared())-x)*s;a=e[0]*w,r=e[1]*w,n=e[2]*w,h=255,t.setPixel(g,m,[a,r,n,h])}},(oo=oo||{}).postpone=function(t){var e=new Image;e.onload=t,e.onerror=t,e.src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs="},oo.NNode=class{constructor(t){this.value=void 0,this.result=void 0,this._done=!1,this._target=[],this._executor=t,this._callback=(t=>{for(var e of(this.result=t,this._done=!0,this._target))this._sendTo(e)})}_sendTo(t){t instanceof oo.NNode&&t.exec(),"function"==typeof t&&t(this.result)}connect(t){this._target.indexOf(t)<0&&this._target.push(t),this._done&&this._sendTo(t)}exec(){this.value=this._executor(this._callback)}},oo.XNode=class extends oo.NNode{constructor(...t){super(...t),this.exec()}},oo.nn=function(t){return new oo.NNode(t)},oo.xn=function(t,...e){return new oo.XNode(i=>{var s=t.length,o=e[s-1];return e[s-1]=(()=>{o&&o(),i()}),t(...e)})},oo.serial=function(t,e){return new oo.XNode(i=>{var s=void 0,o=t(),a=()=>{oo.postpone(()=>{var t=o.next(s);s=t.value instanceof oo.XNode?(t.value.connect(a),t.value.value):t.value,t.done&&(e&&e(),i())})};a()})},oo.parallel=function(t,e){return new oo.XNode(i=>{var s=0,o=t(),a=()=>{oo.postpone(()=>{0==s--&&(e&&e(),i())})},r=void 0;do{var n=o.next(r);r=n.value instanceof oo.XNode?(s++,n.value.connect(a),n.value.value):n.value}while(!n.done);a()})},oo.xnWait=function(t){return new oo.XNode(e=>{setTimeout(e,t)})},oo.createImage=function(t,e){var i=new Image;return i.onload=e,i.onerror=e,i.src=t,i},oo.xnCreateImage=function(t,e){return oo.xn(oo.createImage,t,e)},oo.appendScript=function(t,e){var i=document.createElement("script");i.src=t,i.onload=e,i.onerror=e,document.body.appendChild(i)},oo.xnAppendScript=function(t,e){return new oo.XNode(i=>{oo.appendScript(t,()=>{e&&e(),i()})})},oo.loadText=function(t,e){return oo.ajax("GET",t,null,null,e)},oo.xnLoadText=function(t,e){return new oo.XNode(i=>{oo.loadText(t,()=>{e&&e(),i()})})},oo.ajaxJson=function(t,e,i,s){var o=JSON.stringify(i);return oo.ajax(t,e,o,"application/json",t=>{"ok"===t.status&&(t.obj=JSON.parse(t.text)),s(t)})},oo.ajax=function(t,e,i,s,o){var a={},r=new XMLHttpRequest;return r.open(t,e,!0),r.onload=(()=>{a.text=r.responseText,a.status="ok",o&&o(a)}),r.onerror=(()=>{a.status="error",o&&o(a)}),r.onabort=r.onerror,r.ontimeout=r.onerror,"POST"===t&&(r.setRequestHeader("Content-Type",s||"application/json"),r.send(i)),"GET"===t&&r.send(null),a},(oo=oo||{}).$=function(){var t={},e=function(e){if(!e)return null;if("string"==typeof e){if("#"===e.charAt(0)){var i=e.substr(1);return document.getElementById(i)||t[i]}return"@"===e.charAt(0)?document.createTextNode(e.substr(1)):document.createElement(e)}if("object"==typeof e){if(e instanceof Node)return e;if(e.tag){var s=document.createElement(e.tag);if(s)return e.property&&Object.assign(s,e.property),e.style&&Object.assign(s.style,e.style),e.id&&(s.id=e.id),s.id&&(t[s.id]=s),s}}return null};return function(...t){if(0===t.length)return null;var i=e(t[0]);if(i)for(var s=i,o=1;o<t.length;o++){var a=null,r=t[o];if(Array.isArray(r))for(var n=0;n<r.length;n++)(a=e(r[n]))&&s.appendChild(a);else(a=e(r))&&(s=s.appendChild(a))}return i}};class OoRandom{constructor(t){this.init(t)}init(t){this.x=123456789,this.y=362436069,this.z=521288629,this.w=88675123,void 0!==t&&(this.seed=t),void 0!==this.seed&&(this.w=this.seed),this.nd_idx=0,this.nd_work=0}getUint32(){var t=this.x^this.x<<11;return this.x=this.y,this.y=this.z,this.z=this.w,this.w=this.w^this.w>>>19^t^t>>>8,this.w=this.w>>>0,this.w}get(){return this.getUint32()/4294967296}get1(){return this.getUint32()/4294967295}get2(){return this.getUint32()/2147483648-1}getND(){if(this.nd_idx^=1,0===this.nd_idx)return this.nd_work;do{var t=this.get2(),e=this.get2(),i=t*t+e*e}while(i>1||0===i);return i=Math.sqrt(-2*Math.log(i)/i),this.nd_work=e*i,t*i}getRange(t,e){return t+this.get1()*(e-t)}getIntRange(t,e){return t+this.roll0(e-t+1)}roll0(t){return t=t||6,this.getUint32()%t}roll(t){return this.roll0(t)+1}getUniform3(){var t=this.get2(),e=this.get2(),i=this.get2();return new Oo3DVector(t,e,i)}getBall(){do{var t=this.get2(),e=this.get2(),i=this.get2()}while(t*t+e*e+i*i>1);return new Oo3DVector(t,e,i)}getSphere(){var t=this.get2(),e=Math.sqrt(1-t*t),i=this.get()*Math.PI*2,s=e*Math.cos(i),o=e*Math.sin(i);return new Oo3DVector(s,o,t)}}(oo=oo||{}).env=oo.env||{},oo.env.default_align=1;class OoRect{constructor(t,e,i,s){this.x=t||0,this.y=e||0,this.w=i||0,this.h=s||0}clone(){return new OoRect(this.x,this.y,this.w,this.h)}set(t,e,i,s){t instanceof OoRect?Object.assign(this,t):Object.assign(this,{x:t,y:e,w:i,h:s})}contains(t,e){return t instanceof Oo2DVector&&([t,e]=[t.x,t.y]),!(t<this.x||t>=this.x+this.w)&&!(e<this.y||e>=this.y+this.h)}alignRect(t,e){this.set(oo.alignedRect(t,this,e))}}oo.alignX=function(t,e){return 0===t&&(t=oo.env.default_align),e*((t+2)%3)/2},oo.alignY=function(t,e){return 0===t&&(t=oo.env.default_align),e*Math.floor((t-1)/3)/2},oo.alignedRect=function(t,e,i){var s=t,o=e,a=Math.floor(i/10)%10,r=i%10;0===r&&(r=oo.env.default_align),0===a&&(a=r);var n=s.x+o.x+oo.alignX(a,s.w)-oo.alignX(r,o.w),h=s.y+o.y+oo.alignY(a,s.h)-oo.alignY(r,o.h);return new OoRect(n,h,o.w,o.h)};class OoSha256{constructor(){this._k=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],this._buffer=new Array(64),this._w=new Array(64),this.init()}static _rotate(t,e){return t>>>e|t<<32-e}static _ch(t,e,i){return t&(e^i)^i}static _maj(t,e,i){return t&(e|i)|e&i}static _si0(t){return OoSha256._rotate(t,2)^OoSha256._rotate(t,13)^OoSha256._rotate(t,22)}static _si1(t){return OoSha256._rotate(t,6)^OoSha256._rotate(t,11)^OoSha256._rotate(t,25)}static _s0(t){return OoSha256._rotate(t,7)^OoSha256._rotate(t,18)^t>>>3}static _s1(t){return OoSha256._rotate(t,17)^OoSha256._rotate(t,19)^t>>>10}static _uint8a(t){return[t>>>24,t>>>16&255,t>>>8&255,255&t]}init(){this._h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this._num_bits_h=0,this._num_bits_l=0,this._position=0}load(t){if(0!==t.length){var e=t.length;this._num_bits_l+=e<<3>>>0,this._num_bits_h+=e>>>29,this._num_bits_l>=4294967296&&this._num_bits_h++,this._num_bits_l>>>=0;for(var i=0;i<e;i++)this._buffer[this._position++]=t[i],64===this._position&&this._generate(),this._position&=63}}final(){var t=this._num_bits_h,e=this._num_bits_l;for(this.load([128]);56!=this._position;)this.load([0]);this.load(OoSha256._uint8a(t)),this.load(OoSha256._uint8a(e))}_generate(){var t,e;for(t=0,e=0;t<16;t++,e+=4)this._w[t]=this._buffer[e]<<24|this._buffer[e+1]<<16|this._buffer[e+2]<<8|this._buffer[e+3];for(t=16;t<64;t++)this._w[t]=OoSha256._s1(this._w[t-2])+this._w[t-7]+OoSha256._s0(this._w[t-15])+this._w[t-16]>>>0;var i=this._h[0],s=this._h[1],o=this._h[2],a=this._h[3],r=this._h[4],n=this._h[5],h=this._h[6],c=this._h[7];for(t=0;t<64;t++){var u=c+OoSha256._si1(r)+OoSha256._ch(r,n,h)+this._k[t]+this._w[t],l=OoSha256._si0(i)+OoSha256._maj(i,s,o);c=h,h=n,n=r,r=a+u>>>0,a=o,o=s,s=i,i=u+l>>>0}for(this._h[0]+=i,this._h[1]+=s,this._h[2]+=o,this._h[3]+=a,this._h[4]+=r,this._h[5]+=n,this._h[6]+=h,this._h[7]+=c,t=0;t<8;t++)this._h[t]>>>=0}getDigest(t){t&&(this.init(),this.load(t),this.final());for(var e="",i=0;i<8;i++)e+=("00000000"+this._h[i].toString(16)).slice(-8);return e}static get(t){return(new OoSha256).getDigest(t)}}(oo=oo||{}).sort=function(t,e){var i=function(s,o){if(!(s>=o))if(o-s!=1){var a,r,n,h,c=Math.floor((s+o)/2);i(s,c),i(c+1,o);for(var u=[],l=0,_=s;_<=c;_++)u[l++]=t[_];_=c+1;for(var d=0,f=s;_<=o&&d<l;)t[f++]=e(u[d],t[_])<=0?u[d++]:t[_++];for(;d<l;)t[f++]=u[d++]}else e(t[s],t[o])>0&&(n=o,h=(a=t)[r=s],a[r]=a[n],a[n]=h)};i(0,t.length-1)};class OoSound{constructor(t,e){if(t){this.context=t,this.name=e,this.buffer;var i=this,s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onreadystatechange=function(){4===s.readyState&&(0!==s.status&&200!==s.status||i.context.decodeAudioData(s.response,function(t){i.buffer=t}))},s.send("")}}play(){if(this.context){var t=this.context.createBufferSource();t.buffer=this.buffer,t.connect(this.context.destination),t.start()}}}class OoStopMotion{constructor(){this.fps=60,this.image_base_path="",this.image_files=[],this.images=[],this.total_frames=0,this.current_frame=0,this.frame60=0,this.elapsed_time=0,this.time0=Date.now(),this.position=new Oo2DVector(0)}asyncLoadImage(t){var e=this.image_files.length;this.total_frames=e;var i=this;oo.parallel(function*(){for(let s=0;s<e;s++){var t=oo.addPath(i.image_base_path,i.image_files[s]);i.images[s]=yield oo.xnCreateImage(t)}},t)}start(){this.current_frame=0,this.frame60=0,this.elapsed_time=0,this.time0=Date.now()}updateByTime(){var t=Date.now();this.elapsed_time+=t-this.time0,this.time0=t,this.current_frame=Math.floor(this.elapsed_time*this.fps/1e3)}update(){this.frame60++,this.current_frame=Math.floor(this.frame60*this.fps/60)}draw(t){var e=oo.clamp(this.current_frame,0,this.images.length-1),i=this.images[e];t.drawImage(i,this.position.x,this.position.y)}}class OoTile extends OoDrawObject{constructor(t,e,i){super(),this.size=new Oo2DVector(1,1),this.color=t||"#ffffff"}draw(t){if(this.show){var e=t||this.context||oo.env.context;oo.localAlpha(e,this.alpha,()=>{var t=this.size.x*this.scale.x,i=this.size.y*this.scale.y;e.fillStyle=this.color,0===this.rotation.z?e.fillRect(this.position.x-.5*t,this.position.y-.5*i,t,i):(e.save(),e.setTransform(1,0,0,1,0,0),e.translate(this.position.x,this.position.y),e.rotate(this.rotation.z),e.fillRect(.5*-t,.5*-i,t,i),e.restore())})}}static create(t,e,i){var s=new OoTile;return s.color=t,s.size.set(e,i),s}}(oo=oo||{}).env=oo.env||{},oo.getArrayDiff=function(t,e){var i=[];for(let s of t)-1===e.indexOf(s)&&i.push(s);for(let s of e)-1===t.indexOf(s)&&i.push(s);return i},oo.setupLogEnv=function(){var t=null;oo.log=function(...e){if(console.log.apply(null,e),null===t&&document.body&&(t=document.createElement("div"),document.body.appendChild(t)),t){for(var i of e)"string"==typeof i?t.innerHTML+=i:("object"==typeof i&&(t.innerHTML+=i.constructor.name),t.innerHTML+=JSON.stringify(i));t.innerHTML+="<br>"}}},oo.log=function(...t){console.log.apply(null,t)},oo.getDataset=function(t,e){var i=document.getElementById(t);if(i)return i.dataset[e]},oo.strReplace=function(t,e,i){return t.split(e).join(i)},oo.strToInt=function(t){var e=0;return e="0x"===t.substr(0,2)||"0X"===t.substr(0,2)?Number.parseInt(t,16):Number.parseInt(t,10),Number.isInteger(e)?e:0},oo.dup=function(t,e){for(var i="",s=0;s<e;s++)i+=t;return i},oo.zeroPadding=function(t,e){return("00000000000000000000"+t).slice(-e)},oo.rgbColor=function(t,e,i){return"#"+("000000"+((255&t)<<16|(255&e)<<8|255&i).toString(16)).slice(-6)},oo.arraySwap=function(t,e,i){var s=t[e];t[e]=t[i],t[i]=s},oo.urlSearchParams=function(t){var e=new Map,i=t.split("&");for(var s of i){var o=s.split("=");1===o.length&&e.set(o[0],""),2===o.length&&e.set(o[0],o[1])}return e},oo.urlSearchParams2=function(t){"?"===(t=t||document.location.search).charAt(0)&&(t=t.substr(1));var e={},i=t.split("&");for(var s of i){var o=s.split("=");e[o[0]]=o[1]||""}return e},oo.uint32ToUint8ArrayBE=function(t){return[t>>>24,t>>>16&255,t>>>8&255,255&t]},oo.uint32ToUint8ArrayLE=function(t){return[255&t,t>>>8&255,t>>>16&255,t>>>24]};class Oo2DVector{constructor(t,e){this.x=t||0,this.y=void 0!==e?e:this.x}clone(){return new Oo2DVector(this.x,this.y)}set(t,e){return oo.isObject(t)?(this.x=t.x||0,this.y=t.y||0):(this.x=t||0,this.y=void 0!==e?e:this.x),this}add(t){return this.x+=(oo.isObject(t)?t.x:t)||0,this.y+=(oo.isObject(t)?t.y:t)||0,this}addSV(t,e){return this.x+=(t.x||0)*e,this.y+=(t.y||0)*e,this}sub(t){return this.x-=(oo.isObject(t)?t.x:t)||0,this.y-=(oo.isObject(t)?t.y:t)||0,this}mul(t){return this.x*=(oo.isObject(t)?t.x:t)||0,this.y*=(oo.isObject(t)?t.y:t)||0,this}div(t){return this.x/=(oo.isObject(t)?t.x:t)||1,this.y/=(oo.isObject(t)?t.y:t)||1,this}clamp(t,e){return this.x<t&&(this.x=t),this.y<t&&(this.y=t),this.x>e&&(this.x=e),this.y>e&&(this.y=e),this}negate(){return this.x=-this.x,this.y=-this.y,this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}rotate90(){return[this.x,this.y]=[-this.y,this.x],this}normalize(){var t=this.getMagnitude();return t>0&&(t=1/t),this.x*=t,this.y*=t,this}getNegation(){return this.clone().negate()}getRound(){return this.clone().round()}getNormal(){return this.clone().normalize()}getMagnitudeSquared(){return this.x*this.x+this.y*this.y}getMagnitude(){return Math.sqrt(this.getMagnitudeSquared())}getAtan2(){return Math.atan2(this.y,this.x)}getDegree(){return 180*Math.atan2(this.y,this.x)/Math.PI}static add(t,e){return t.clone().add(e)}static sub(t,e){return t.clone().sub(e)}static mul(t,e){return t.clone().mul(e)}static div(t,e){return t.clone().div(e)}static angle(t,e){return Math.acos(Oo2DVector.dot(e,t)/(e.getMagnitude()*t.getMagnitude()))}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static distance(t,e){return Oo2DVector.sub(t,e).getMagnitude()}static lerp(t,e,i){return new Oo2DVector((1-i)*t.x+i*e.x,(1-i)*t.y+i*e.y)}static cubicBezierCurves(t,e,i,s,o){var a=1-o,r=a*a*a,n=3*a*a*o,h=3*a*o*o,c=o*o*o,u=new Oo2DVector(0,0);return u.addSV(t,r),u.addSV(e,n),u.addSV(i,h),u.addSV(s,c),u}static create(t,e){return new Oo2DVector(t,e)}}class Oo3DVector{constructor(t,e,i){this.x=t||0,this.y=void 0===e?this.x:e,this.z=void 0===i?this.y:i}clone(){return new Oo3DVector(this.x,this.y,this.z)}set(t,e,i){return oo.isObject(t)?(this.x=t.x||0,this.y=t.y||0,this.z=t.z||0):(this.x=t||0,this.y=void 0!==e?e:this.x,this.z=void 0!==i?i:this.y),this}add(t){return this.x+=(oo.isObject(t)?t.x:t)||0,this.y+=(oo.isObject(t)?t.y:t)||0,this.z+=(oo.isObject(t)?t.z:t)||0,this}addSV(t,e){return this.x+=(t.x||0)*e,this.y+=(t.y||0)*e,this.z+=(t.z||0)*e,this}sub(t){return this.x-=(oo.isObject(t)?t.x:t)||0,this.y-=(oo.isObject(t)?t.y:t)||0,this.z-=(oo.isObject(t)?t.z:t)||0,this}mul(t){return this.x*=(oo.isObject(t)?t.x:t)||0,this.y*=(oo.isObject(t)?t.y:t)||0,this.z*=(oo.isObject(t)?t.z:t)||0,this}div(t){return this.x/=(oo.isObject(t)?t.x:t)||1,this.y/=(oo.isObject(t)?t.y:t)||1,this.z/=(oo.isObject(t)?t.z:t)||1,this}clamp(t,e){return this.x<t&&(this.x=t),this.y<t&&(this.y=t),this.z<t&&(this.z=t),this.x>e&&(this.x=e),this.y>e&&(this.y=e),this.z>e&&(this.z=e),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}normalize(){var t=this.getMagnitude();return t>0&&(t=1/t),this.x*=t,this.y*=t,this.z*=t,this}getNegation(){return this.clone().negate()}getRound(){return this.clone().round()}getNormal(){return this.clone().normalize()}getMagnitudeSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}getMagnitude(){return Math.sqrt(this.getMagnitudeSquared())}getAtan2(){return Math.atan2(this.y,this.x)}getDegree(){return 180*Math.atan2(this.y,this.x)/Math.PI}static add(t,e){return t.clone().add(e)}static sub(t,e){return t.clone().sub(e)}static mul(t,e){return t.clone().mul(e)}static div(t,e){return t.clone().div(e)}static angle(t,e){return Math.acos(Oo3DVector.dot(e,t)/(e.getMagnitude()*t.getMagnitude()))}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static cross(t,e){return new Oo3DVector(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)}static distance(t,e){return Oo3DVector.sub(t,e).getMagnitude()}static lerp(t,e,i){return new Oo3DVector((1-i)*t.x+i*e.x,(1-i)*t.y+i*e.y,(1-i)*t.z+i*e.z)}static cubicBezierCurves(t,e,i,s,o){var a=1-o,r=a*a*a,n=3*a*a*o,h=3*a*o*o,c=o*o*o,u=new Oo3DVector(0,0,0);return u.addSV(t,r),u.addSV(e,n),u.addSV(i,h),u.addSV(s,c),u}static create(t,e,i){return new Oo3DVector(t,e)}}(oo=oo||{}).wrapBeforeAfter=function(t,e,i){return function(...s){e&&e(...s);var o=t(...s);return i&&i(o),o}},oo.wrap=function(t,...e){var i=Object.keys(t)[0],s=t[i],o=e[0],a=e[1];if("function"==typeof o&&"function"==typeof o)return oo.wrapBeforeAfter(s,o,a);var r=e[0];if("string"==typeof r){if("log"===r)return oo.wrapBeforeAfter(s,()=>{oo.log("log:",i)},null);if("inout"===r)return oo.wrapBeforeAfter(s,()=>{oo.log("in:",i)},()=>{oo.log("out:",i)});var n;if("time"===r)return oo.wrapBeforeAfter(s,()=>{n=performance.now()},()=>{oo.log("time:",i," ",""+(performance.now()-n))});if("check"===r)return oo.wrapBeforeAfter(s,(...t)=>{oo.log("check:",i," ","args:",t)},t=>{oo.log("check:",i," ","result:",t)})}return s};